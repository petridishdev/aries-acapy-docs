"use strict";(self.webpackChunkaries_cloud_agent_python_documentation=self.webpackChunkaries_cloud_agent_python_documentation||[]).push([[6894],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},h="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),h=c(n),u=i,m=h["".concat(s,".").concat(u)]||h[u]||p[u]||r;return n?a.createElement(m,o(o({ref:t},d),{},{components:n})):a.createElement(m,o({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[h]="string"==typeof e?e:i,o[1]=l;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6501:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var a=n(7462),i=(n(7294),n(3905));const r={title:"Aries OpenAPI Demo"},o="Aries OpenAPI Demo \x3c!-- omit in toc --\x3e",l={unversionedId:"demo/AriesOpenAPIDemo",id:"demo/AriesOpenAPIDemo",title:"Aries OpenAPI Demo",description:"What better way to learn about controllers than by actually being one yourself! In this demo, that\u2019s just what happens&mdash;you are the controller. You have access to the full set of API endpoints exposed by an ACA-Py instance, and you will see the events coming from ACA-Py as they happen. Using that information, you'll help Alice's and Faber's agents connect, Faber's agent issue an education credential to Alice, and then ask Alice to prove she possesses the credential. Who knows why Faber needs to get the proof, but it lets us show off more protocols.",source:"@site/docs/demo/AriesOpenAPIDemo.md",sourceDirName:"demo",slug:"/demo/AriesOpenAPIDemo",permalink:"/aries-acapy-docs/demo/AriesOpenAPIDemo",draft:!1,editUrl:"https://github.com/hyperledger/aries-acapy-docs/tree/main/docs/docusaurus/docs/demo/AriesOpenAPIDemo.md",tags:[],version:"current",frontMatter:{title:"Aries OpenAPI Demo"},sidebar:"tutorialSidebar",previous:{title:"How to Issue JSON-LD Credentials using Aca-py",permalink:"/aries-acapy-docs/demo/AliceWantsAJsonCredential"},next:{title:"Endorser Demo",permalink:"/aries-acapy-docs/demo/Endorser"}},s={},c=[{value:"Getting Started",id:"getting-started",level:2},{value:"Running in a Browser",id:"running-in-a-browser",level:2},{value:"Start the Faber Agent",id:"start-the-faber-agent",level:3},{value:"Start the Alice Agent",id:"start-the-alice-agent",level:3},{value:"Running in Docker",id:"running-in-docker",level:2},{value:"Start the Faber Agent",id:"start-the-faber-agent-1",level:3},{value:"Start the Alice Agent",id:"start-the-alice-agent-1",level:3},{value:"Restarting the Docker Containers",id:"restarting-the-docker-containers",level:3},{value:"Using the OpenAPI/Swagger User Interface",id:"using-the-openapiswagger-user-interface",level:2},{value:"Establishing a Connection",id:"establishing-a-connection",level:2},{value:"Use the Faber Agent to Create an Invitation",id:"use-the-faber-agent-to-create-an-invitation",level:3},{value:"Copy the Invitation created by the Faber Agent",id:"copy-the-invitation-created-by-the-faber-agent",level:3},{value:"Use the Alice Agent to Receive Faber&#39;s Invitation",id:"use-the-alice-agent-to-receive-fabers-invitation",level:3},{value:"Tell Alice&#39;s Agent to <em>Accept</em> the Invitation",id:"tell-alices-agent-to-accept-the-invitation",level:3},{value:"The Faber Agent Gets the Request",id:"the-faber-agent-gets-the-request",level:3},{value:"The Faber Agent Completes the Connection",id:"the-faber-agent-completes-the-connection",level:3},{value:"Review the Connection Status in Alice&#39;s Agent",id:"review-the-connection-status-in-alices-agent",level:3},{value:"Review the Connection Status in Faber&#39;s Agent",id:"review-the-connection-status-in-fabers-agent",level:3},{value:"Basic Messaging Between Agents",id:"basic-messaging-between-agents",level:2},{value:"Sending a message from Alice to Faber",id:"sending-a-message-from-alice-to-faber",level:3},{value:"Receiving a Basic Message (Faber)",id:"receiving-a-basic-message-faber",level:3},{value:"Alice&#39;s Agent Verifies that Faber has Received the Message",id:"alices-agent-verifies-that-faber-has-received-the-message",level:3},{value:"Preparing to Issue a Credential",id:"preparing-to-issue-a-credential",level:2},{value:"Confirming your Schema and Credential Definition",id:"confirming-your-schema-and-credential-definition",level:3},{value:"Notes",id:"notes",level:3},{value:"Issuing a Credential",id:"issuing-a-credential",level:2},{value:"Faber - Preparing to Issue a Credential",id:"faber---preparing-to-issue-a-credential",level:3},{value:"Faber - Issuing the Credential",id:"faber---issuing-the-credential",level:3},{value:"Alice Receives Credential",id:"alice-receives-credential",level:3},{value:"Alice Stores Credential in her Wallet",id:"alice-stores-credential-in-her-wallet",level:3},{value:"Faber Receives Acknowledgment that the Credential was Received",id:"faber-receives-acknowledgment-that-the-credential-was-received",level:3},{value:"Issue Credential Notes",id:"issue-credential-notes",level:3},{value:"Bonus Points",id:"bonus-points",level:3},{value:"Requesting/Presenting a Proof",id:"requestingpresenting-a-proof",level:2},{value:"Faber sends a Proof Request",id:"faber-sends-a-proof-request",level:3},{value:"Alice - Responding to the Proof Request",id:"alice---responding-to-the-proof-request",level:3},{value:"Faber - Verifying the Proof",id:"faber---verifying-the-proof",level:3},{value:"Present Proof Notes",id:"present-proof-notes",level:3},{value:"Bonus Points",id:"bonus-points-1",level:3},{value:"Conclusion",id:"conclusion",level:2}],d={toc:c},h="wrapper";function p(e){let{components:t,...n}=e;return(0,i.kt)(h,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"aries-openapi-demo--omit-in-toc-"},"Aries OpenAPI Demo "),(0,i.kt)("p",null,"What better way to learn about controllers than by actually being one yourself! In this demo, that\u2019s just what happens","\u2014","you are the controller. You have access to the full set of API endpoints exposed by an ACA-Py instance, and you will see the events coming from ACA-Py as they happen. Using that information, you'll help Alice's and Faber's agents connect, Faber's agent issue an education credential to Alice, and then ask Alice to prove she possesses the credential. Who knows why Faber needs to get the proof, but it lets us show off more protocols."),(0,i.kt)("h1",{id:"contents--omit-in-toc-"},"Contents "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#getting-started"},"Getting Started")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#running-in-a-browser"},"Running in a Browser"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#start-the-faber-agent"},"Start the Faber Agent")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#start-the-alice-agent"},"Start the Alice Agent")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#running-in-docker"},"Running in Docker"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#start-the-faber-agent-1"},"Start the Faber Agent")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#start-the-alice-agent-1"},"Start the Alice Agent")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#restarting-the-docker-containers"},"Restarting the Docker Containers")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#using-the-openapiswagger-user-interface"},"Using the OpenAPI/Swagger User Interface")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#establishing-a-connection"},"Establishing a Connection"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#use-the-faber-agent-to-create-an-invitation"},"Use the Faber Agent to Create an Invitation")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#copy-the-invitation-created-by-the-faber-agent"},"Copy the Invitation created by the Faber Agent")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#use-the-alice-agent-to-receive-fabers-invitation"},"Use the Alice Agent to Receive Faber's Invitation")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#tell-alices-agent-to-accept-the-invitation"},"Tell Alice's Agent to ",(0,i.kt)("em",{parentName:"a"},"Accept")," the Invitation")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#the-faber-agent-gets-the-request"},"The Faber Agent Gets the Request")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#the-faber-agent-completes-the-connection"},"The Faber Agent Completes the Connection")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#review-the-connection-status-in-alices-agent"},"Review the Connection Status in Alice's Agent")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#review-the-connection-status-in-fabers-agent"},"Review the Connection Status in Faber's Agent")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#basic-messaging-between-agents"},"Basic Messaging Between Agents"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#sending-a-message-from-alice-to-faber"},"Sending a message from Alice to Faber")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#receiving-a-basic-message-faber"},"Receiving a Basic Message (Faber)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#alices-agent-verifies-that-faber-has-received-the-message"},"Alice's Agent Verifies that Faber has Received the Message")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#preparing-to-issue-a-credential"},"Preparing to Issue a Credential"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#confirming-your-schema-and-credential-definition"},"Confirming your Schema and Credential Definition")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#notes"},"Notes")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#issuing-a-credential"},"Issuing a Credential"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#faber---preparing-to-issue-a-credential"},"Faber - Preparing to Issue a Credential")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#faber---issuing-the-credential"},"Faber - Issuing the Credential")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#alice-receives-credential"},"Alice Receives Credential")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#alice-stores-credential-in-her-wallet"},"Alice Stores Credential in her Wallet")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#faber-receives-acknowledgment-that-the-credential-was-received"},"Faber Receives Acknowledgment that the Credential was Received")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#issue-credential-notes"},"Issue Credential Notes")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#bonus-points"},"Bonus Points")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#requestingpresenting-a-proof"},"Requesting/Presenting a Proof"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#faber-sends-a-proof-request"},"Faber sends a Proof Request")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#alice---responding-to-the-proof-request"},"Alice - Responding to the Proof Request")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#faber---verifying-the-proof"},"Faber - Verifying the Proof")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#present-proof-notes"},"Present Proof Notes")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#bonus-points-1"},"Bonus Points")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#conclusion"},"Conclusion"))),(0,i.kt)("h2",{id:"getting-started"},"Getting Started"),(0,i.kt)("p",null,"We will get started by opening three browser tabs that will be used throughout the lab. Two will be Swagger UIs for the Faber and Alice agent and one for the public ledger (showing the Hyperledger Indy ledger). As well, we'll keep the terminal sessions where we started the demos handy, as we'll be grabbing information from them as well."),(0,i.kt)("p",null,"Let's start with the ledger browser. For this demo, we're going to use an open public ledger operated by the BC Government's VON Team. In your first browser tab, go to: ",(0,i.kt)("a",{parentName:"p",href:"http://dev.greenlight.bcovrin.vonx.io"},"http://dev.greenlight.bcovrin.vonx.io"),'. This will be called the "ledger tab" in the instructions below.'),(0,i.kt)("p",null,"For the rest of the set up, you can choose to run the terminal sessions in your browser (no local resources needed), or you can run it in Docker on your local system. Your choice, each is covered in the next two sections."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note: In the following, when we start the agents we use several special demo settings. The command we use is this: ",(0,i.kt)("inlineCode",{parentName:"p"},"LEDGER_URL=http://dev.greenlight.bcovrin.vonx.io ./run_demo faber --events --no-auto --bg"),". In that:"),(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"LEDGER_URL")," environment variable informs the agent what ledger to use."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"--events")," option indicates that we want the controller to display the webhook events from ACA-Py in the log displayed on the terminal."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"--no-auto")," option indicates that we don't want the ACA-Py agent to automatically handle some events such as connecting. We want the controller (you!) to handle each step of the protocol."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"--bg")," option indicates that the docker container will run in the background, so accidentally hitting Ctrl-C won't stop the process."))),(0,i.kt)("h2",{id:"running-in-a-browser"},"Running in a Browser"),(0,i.kt)("p",null,"To run the necessary terminal sessions in your browser, go to the Docker playground service ",(0,i.kt)("a",{parentName:"p",href:"https://labs.play-with-docker.com/"},"Play with Docker"),". Don't know about Play with Docker? Check ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cloudcompass/ToIPLabs/blob/master/docs/LFS173x/RunningLabs.md#running-on-play-with-docker"},"this out")," to learn more."),(0,i.kt)("h3",{id:"start-the-faber-agent"},"Start the Faber Agent"),(0,i.kt)("p",null,"In a browser, go to the ",(0,i.kt)("a",{parentName:"p",href:"https://labs.play-with-docker.com/"},"Play with Docker"),' home page, Login (if necessary) and click "Start." On the next screen, click (in the left menu) "+Add a new instance." That will start up a terminal in your browser. Run the following commands to start the Faber agent.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/hyperledger/aries-cloudagent-python\ncd aries-cloudagent-python/demo\nLEDGER_URL=http://dev.greenlight.bcovrin.vonx.io ./run_demo faber --events --no-auto --bg\n\n")),(0,i.kt)("p",null,"Once you are back at the command prompt, we'll use docker's logging capability to see what's being written to the terminal:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker logs -f faber\n")),(0,i.kt)("p",null,"Once the Faber agent has started up (with the invite displayed), click the link near the top of the screen ",(0,i.kt)("inlineCode",{parentName:"p"},"8021"),". That will start an instance of the OpenAPI/Swagger user interface connected to the Faber instance. Note that the URL on the OpenAPI/Swagger instance is: ",(0,i.kt)("inlineCode",{parentName:"p"},"http://ip....8021.direct..."),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Remember that the OpenAPI/Swagger browser tab with an address containing 8021 is the Faber agent.")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},'NOTE: Hit "Ctrl-C" at any time to get back to the command line. When you are done with the command line, you can return to seeing the logs from the Faber agent by running ',(0,i.kt)("inlineCode",{parentName:"p"},"docker logs -f faber"))),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot!"),(0,i.kt)("img",{src:"./collateral/Faber-Agent.png",alt:"Swagger Page for Faber Agent"})),(0,i.kt)("h3",{id:"start-the-alice-agent"},"Start the Alice Agent"),(0,i.kt)("p",null,"Now to start Alice's agent. Click the \"+Add a new instance\" button again to open another terminal session. Run the following commands to start Alice's agent:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/hyperledger/aries-cloudagent-python\ncd aries-cloudagent-python/demo\nLEDGER_URL=http://dev.greenlight.bcovrin.vonx.io ./run_demo alice --events --no-auto --bg\n\n")),(0,i.kt)("p",null,"Once you are back at the command prompt, we'll use docker's logging capability to see what's being written to the terminal:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker logs -f alice\n")),(0,i.kt)("p",null,"You can ignore a message like ",(0,i.kt)("inlineCode",{parentName:"p"},"WARNING: your terminal doesn't support cursor position requests (CPR).")),(0,i.kt)("p",null,"Once the Alice agent has started up (with the ",(0,i.kt)("inlineCode",{parentName:"p"},"invite:")," prompt displayed), click the link near the top of the screen ",(0,i.kt)("inlineCode",{parentName:"p"},"8031"),". That will start an instance of the OpenAPI/Swagger User Interface connected to the Alice instance. Note that the URL on the OpenAPI/Swagger instance is: ",(0,i.kt)("inlineCode",{parentName:"p"},"http://ip....8031.direct..."),"."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},'NOTE: Hit "Ctrl-C" to get back to the command line. When you are done with the command line, you can return to seeing the logs from the Faber agent by running ',(0,i.kt)("inlineCode",{parentName:"p"},"docker logs -f faber"))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Remember that the OpenAPI/Swagger browser tab with an address containing 8031 is Alice's agent.")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot!"),(0,i.kt)("img",{src:"./collateral/Alice-Agent.png",alt:"Swagger Page for Alice Agent"})),(0,i.kt)("p",null,"You are ready to go. Skip down to the ",(0,i.kt)("a",{parentName:"p",href:"#using-the-openapiswagger-user-interface"},"Using the OpenAPI/Swagger User Interface")," section."),(0,i.kt)("h2",{id:"running-in-docker"},"Running in Docker"),(0,i.kt)("p",null,"To run the demo on your local system, you must have git, a running Docker installation, and terminal windows running bash. Need more information about getting set up? Click ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cloudcompass/ToIPLabs/blob/master/docs/LFS173x/RunningLabs.md#running-on-docker-locally"},"here")," to learn more."),(0,i.kt)("h3",{id:"start-the-faber-agent-1"},"Start the Faber Agent"),(0,i.kt)("p",null,"To begin running the demo in Docker, open up two terminal windows, one each for Faber\u2019s and Alice\u2019s agent."),(0,i.kt)("p",null,"In the first terminal window, clone the ACA-Py repo, change into the demo folder and start the Faber agent:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/hyperledger/aries-cloudagent-python\ncd aries-cloudagent-python/demo\nLEDGER_URL=http://dev.greenlight.bcovrin.vonx.io ./run_demo faber --events --no-auto --bg\n\n")),(0,i.kt)("p",null,"Once you are back at the command prompt, we'll use docker's logging capability to see what's being written to the terminal:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker logs -f faber\n")),(0,i.kt)("p",null,"If all goes well, the agent will show a message indicating it is running. Use the second browser tab to navigate to ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:8021"},"http://localhost:8021"),". You should see an OpenAPI/Swagger user interface with a (long-ish) list of API endpoints. These are the endpoints exposed by the Faber agent."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},'NOTE: Hit "Ctrl-C" to get back to the command line. When you are done with the command line, you can return to seeing the logs from the Faber agent by running ',(0,i.kt)("inlineCode",{parentName:"p"},"docker logs -f faber"))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Remember that the OpenAPI/Swagger browser tab with an address containing 8021 is the Faber agent.")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot!"),(0,i.kt)("img",{src:"./collateral/Faber-Agent-Local.png",alt:"Swagger Page for Faber Agent"})),(0,i.kt)("h3",{id:"start-the-alice-agent-1"},"Start the Alice Agent"),(0,i.kt)("p",null,"To start Alice's agent, open up a second terminal window and in it, change to the same ",(0,i.kt)("inlineCode",{parentName:"p"},"demo")," directory as where Faber's agent was started above. Once there, start Alice's agent:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"LEDGER_URL=http://dev.greenlight.bcovrin.vonx.io ./run_demo alice --events --no-auto --bg\n\n")),(0,i.kt)("p",null,"Once you are back at the command prompt, we'll use docker's logging capability to see what's being written to the terminal:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker logs -f alice\n")),(0,i.kt)("p",null,"You can ignore a message like ",(0,i.kt)("inlineCode",{parentName:"p"},"WARNING: your terminal doesn't support cursor position requests (CPR)")," that may appear."),(0,i.kt)("p",null,"If all goes well, the agent will show a message indicating it is running. Open a third browser tab and navigate to ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:8031"},"http://localhost:8031"),". Again, you should see the OpenAPI/Swagger user interface with a list of API endpoints, this time the endpoints for Alice\u2019s agent."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},'NOTE: Hit "Ctrl-C" to get back to the command line. When you are done with the command line, you can return to seeing the logs from the Alice agent by running ',(0,i.kt)("inlineCode",{parentName:"p"},"docker logs -f alice"))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Remember that the OpenAPI/Swagger browser tab with an address containing 8031 is Alice's agent.")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot!"),(0,i.kt)("img",{src:"./collateral/Alice-Agent-Local.png",alt:"Swagger Page for Alice Agent"})),(0,i.kt)("h3",{id:"restarting-the-docker-containers"},"Restarting the Docker Containers"),(0,i.kt)("p",null,"When you complete the entire demo (",(0,i.kt)("strong",{parentName:"p"},"not now!!"),"), you can need to stop the two agents. To do that, get to the command line by hitting Ctrl-C and running:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker stop faber\ndocker stop alice\n")),(0,i.kt)("h2",{id:"using-the-openapiswagger-user-interface"},"Using the OpenAPI/Swagger User Interface"),(0,i.kt)("p",null,"Try to organize what you see on your screen to include both the Alice and Faber OpenAPI/Swagger tabs, and both (Alice and Faber) terminal sessions, all at the same time. After you execute an API call in one of the browser tabs, you will see a webhook event from the ACA-Py instance in the terminal window of the other agent. That's a controller's life. See an event, process it, send a response."),(0,i.kt)("p",null,"From time to time you will want to see what's happening on the ledger, so keep that handy as well. As well, if you make an error with one of the commands (e.g. bad data, improperly structured JSON), you will see the errors in the terminals."),(0,i.kt)("p",null,"In the instructions that follow, we\u2019ll let you know if you need to be in the Faber, Alice or Indy browser tab. We\u2019ll leave it to you to track which is which."),(0,i.kt)("p",null,"Using the OpenAPI/Swagger user interface is pretty simple. In the steps below, we\u2019ll indicate what API endpoint you need use, such as ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /connections/create-invitation")),". That means you must:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"scroll to and find that endpoint;"),(0,i.kt)("li",{parentName:"ol"},"click on the endpoint name to expand its section of the UI;"),(0,i.kt)("li",{parentName:"ol"},"click on the ",(0,i.kt)("inlineCode",{parentName:"li"},"Try it out")," button;"),(0,i.kt)("li",{parentName:"ol"},"fill in any data necessary to run the command;"),(0,i.kt)("li",{parentName:"ol"},"click ",(0,i.kt)("inlineCode",{parentName:"li"},"Execute"),";"),(0,i.kt)("li",{parentName:"ol"},"check the response to see if the request worked.")),(0,i.kt)("p",null,"So, the mechanical steps are easy. It\u2019s fourth step from the list above that can be tricky. Supplying the right data and, where JSON is involved, getting the syntax correct - braces and quotes can be a pain. When steps don\u2019t work, start your debugging by looking at your JSON."),(0,i.kt)("p",null,"Enough with the preliminaries, let\u2019s get started!"),(0,i.kt)("h2",{id:"establishing-a-connection"},"Establishing a Connection"),(0,i.kt)("p",null,"We\u2019ll start the demo by establishing a connection between the Alice and Faber agents. We\u2019re starting there to demonstrate that you can use agents without having a ledger. We won\u2019t be using the Indy public ledger at all for this step. Since the agents communicate using DIDComm messaging and connect by exchanging pairwise DIDs and DIDDocs based on (an early version of) the ",(0,i.kt)("inlineCode",{parentName:"p"},"did:peer")," DID method, a public ledger is not needed."),(0,i.kt)("h3",{id:"use-the-faber-agent-to-create-an-invitation"},"Use the Faber Agent to Create an Invitation"),(0,i.kt)("p",null,"In the Faber browser tab, navigate to the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /connections/create-invitation"))," endpoint. Replace the sample body with and empty production (",(0,i.kt)("inlineCode",{parentName:"p"},"{}"),") and execute the call. If successful, you should see a connection id, an invitation, and the invitation URL. The connection ids will be different on each run."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Hint: set an Alias on the Invitation, this makes it easier to find the Connection later on")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Create Invitation Request"),(0,i.kt)("img",{src:"./collateral/1-Faber-Invitation-1.png",alt:"Create Invitation Request"})),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Create Invitation Response"),(0,i.kt)("img",{src:"./collateral/1-Faber-Invitation-2.png",alt:"Create Invitation Response"})),(0,i.kt)("h3",{id:"copy-the-invitation-created-by-the-faber-agent"},"Copy the Invitation created by the Faber Agent"),(0,i.kt)("p",null,"Copy the entire block of the ",(0,i.kt)("inlineCode",{parentName:"p"},"invitation")," object, from the curly brackets ",(0,i.kt)("inlineCode",{parentName:"p"},"{}"),", excluding the trailing comma."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Create Invitation Response"),(0,i.kt)("img",{src:"./collateral/1-Faber-Invitation-3.png",alt:"Create Invitation Response"})),(0,i.kt)("p",null,"Before switching over to the Alice browser tab, scroll to and execute the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /connections"))," endpoint to see the list of Faber's connections. You should see a connection with a ",(0,i.kt)("inlineCode",{parentName:"p"},"connection_id")," that is identical to the invitation you just created, and that its state is ",(0,i.kt)("inlineCode",{parentName:"p"},"invitation"),"."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Faber Connection Status"),(0,i.kt)("img",{src:"./collateral/1-Faber-Invitation-4.png",alt:"Faber Connection Status"})),(0,i.kt)("h3",{id:"use-the-alice-agent-to-receive-fabers-invitation"},"Use the Alice Agent to Receive Faber's Invitation"),(0,i.kt)("p",null,"Switch to the Alice browser tab and get ready to execute the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /connections/receive-invitation"))," endpoint. Select all of the pre-populated text and replace it with the invitation object from the Faber tab. When you click ",(0,i.kt)("inlineCode",{parentName:"p"},"Execute")," you should get back a connection response with a connection Id, an invitation key, and the state of the connection, which should be ",(0,i.kt)("inlineCode",{parentName:"p"},"invitation"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Hint: set an Alias on the Invitation, this makes it easier to find the Connection later on")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Receive Invitation Request"),(0,i.kt)("img",{src:"./collateral/2-Alice-Invitation-1.png",alt:"Receive Invitation Request"})),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Receive Invitation Response"),(0,i.kt)("img",{src:"./collateral/2-Alice-Invitation-2.png",alt:"Receive Invitation Request"})),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"A key observation to make here. The \"copy and paste\" we are doing here from Faber's agent to Alice's agent is what is called an \"out of band\" message. Because we don't yet have a DIDComm connection between the two agents, we have to convey the invitation in plaintext (we can't encrypt it - no channel) using some other mechanism than DIDComm. With mobile agents, that's where QR codes often come in. Once we have the invitation in the receivers agent, we can get back to using DIDComm.")),(0,i.kt)("h3",{id:"tell-alices-agent-to-accept-the-invitation"},"Tell Alice's Agent to ",(0,i.kt)("em",{parentName:"h3"},"Accept")," the Invitation"),(0,i.kt)("p",null,"At this point Alice has simply stored the invitation in her wallet. You can see the status using the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /connections"))," endpoint."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot"),(0,i.kt)("img",{src:"./collateral/2-Alice-Invitation-3.png",alt:"Invitation Status"})),(0,i.kt)("p",null,"To complete a connection with Faber, she must accept the invitation and send a corresponding connection request to Faber. Find the ",(0,i.kt)("inlineCode",{parentName:"p"},"connection_id")," in the connection response from the previous ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /connections/receive-invitation"))," endpoint call. You may note that the same data was sent to the controller as an event from ACA-Py and is visible in the terminal. Scroll to the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /connections/{conn_id}/accept-invitation"))," endpoint and paste the ",(0,i.kt)("inlineCode",{parentName:"p"},"connection_id")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"id")," parameter field (you will have to click the ",(0,i.kt)("inlineCode",{parentName:"p"},"Try it out")," button to see the available URL parameters). The response from clicking ",(0,i.kt)("inlineCode",{parentName:"p"},"Execute")," should show that the connection has a state of ",(0,i.kt)("inlineCode",{parentName:"p"},"request"),"."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Accept Invitation Request"),(0,i.kt)("img",{src:"./collateral/2-Alice-Invitation-4.png",alt:"Receive Invitation Request"})),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Accept Invitation Response"),(0,i.kt)("img",{src:"./collateral/2-Alice-Invitation-5.png",alt:"Receive Invitation Response"})),(0,i.kt)("h3",{id:"the-faber-agent-gets-the-request"},"The Faber Agent Gets the Request"),(0,i.kt)("p",null,"In the Faber terminal session, an event (a web service callback from ACA-Py to the controller) has been received about the request from Alice. Copy the ",(0,i.kt)("inlineCode",{parentName:"p"},"connection_id")," from the event for the next step."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me the event"),(0,i.kt)("img",{src:"./collateral/3-Faber-Connection-2.png",alt:"Connection Request Event"})),(0,i.kt)("p",null,"Note that the connection ID held by Alice is different from the one held by Faber. That makes sense, as both independently created connection objects, each with a unique, self-generated GUID."),(0,i.kt)("h3",{id:"the-faber-agent-completes-the-connection"},"The Faber Agent Completes the Connection"),(0,i.kt)("p",null,"To complete the connection process, Faber will respond to the connection request from Alice. Scroll to the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /connections/{conn_id}/accept-request"))," endpoint and paste the ",(0,i.kt)("inlineCode",{parentName:"p"},"connection_id")," you previously copied into the ",(0,i.kt)("inlineCode",{parentName:"p"},"id")," parameter field (you will have to click the ",(0,i.kt)("inlineCode",{parentName:"p"},"Try it out")," button to see the available URL parameters). The response from clicking the ",(0,i.kt)("inlineCode",{parentName:"p"},"Execute")," button should show that the connection has a state of ",(0,i.kt)("inlineCode",{parentName:"p"},"response"),", which indicates that Faber has accepted Alice's connection request."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Accept Connection Request"),(0,i.kt)("img",{src:"./collateral/3-Faber-Connection-3.png",alt:"Accept Connection Request"})),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Accept Connection Request"),(0,i.kt)("img",{src:"./collateral/3-Faber-Connection-4.png",alt:"Accept Connection Request"})),(0,i.kt)("h3",{id:"review-the-connection-status-in-alices-agent"},"Review the Connection Status in Alice's Agent"),(0,i.kt)("p",null,"Switch over to the Alice browser tab."),(0,i.kt)("p",null,"Scroll to and execute ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /connections"))," to see a list of Alice's connections, and the information tracked about each connection. You should see the one connection Alice\u2019s agent has, that it is with the Faber agent, and that its state is ",(0,i.kt)("inlineCode",{parentName:"p"},"active"),"."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Alice Connection Status"),(0,i.kt)("img",{src:"./collateral/4-Alice-Connection-2.png",alt:"Alice Connection Event"})),(0,i.kt)("p",null,"As with Faber's side of the connection, Alice received a notification that Faber had accepted her connection request."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me the event"),(0,i.kt)("img",{src:"./collateral/4-Alice-Connection-1.png",alt:"Alice Connection Status"})),(0,i.kt)("h3",{id:"review-the-connection-status-in-fabers-agent"},"Review the Connection Status in Faber's Agent"),(0,i.kt)("p",null,"You are connected! Switch to the Faber browser tab and run the same ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /connections"))," endpoint to see Faber's view of the connection. Its state is also ",(0,i.kt)("inlineCode",{parentName:"p"},"active"),". Note the ",(0,i.kt)("inlineCode",{parentName:"p"},"connection_id"),", you\u2019ll need it later in the tutorial."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - Faber Connection Status"),(0,i.kt)("img",{src:"./collateral/5-Faber-Connection-1.png",alt:"Faber Connection Status"})),(0,i.kt)("h2",{id:"basic-messaging-between-agents"},"Basic Messaging Between Agents"),(0,i.kt)("p",null,"Once you have a connection between two agents, you have a channel to exchange secure, encrypted messages. In fact these underlying encrypted messages (similar to envelopes in a postal system) enable the delivery of messages that form the higher level protocols, such as issuing Credentials and providing Proofs. So, let's send a couple of messages that contain the simplest of context","\u2014","text. For this we wil use the Basic Message protocol, ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-rfcs/tree/master/features/0095-basic-message"},"Aries RFC 0095"),"."),(0,i.kt)("h3",{id:"sending-a-message-from-alice-to-faber"},"Sending a message from Alice to Faber"),(0,i.kt)("p",null,"On Alice's swagger page, scroll to the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /connections/{conn_id}/send-message"))," endpoint. Click on ",(0,i.kt)("inlineCode",{parentName:"p"},"Try it Out")," and enter a message in the body provided (for example ",(0,i.kt)("inlineCode",{parentName:"p"},'{"content": "Hello Faber"}'),"). Enter the connection id of Alice's connection in the field provided. Then click on ",(0,i.kt)("inlineCode",{parentName:"p"},"Execute"),"."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot"),(0,i.kt)("img",{src:"./collateral/6-Alice-Basic-Msg.png",alt:"Alice Send Message"})),(0,i.kt)("h3",{id:"receiving-a-basic-message-faber"},"Receiving a Basic Message (Faber)"),(0,i.kt)("p",null,"How does Faber know that a message was sent? If you take a look at Faber's console window, you can see that Faber's agent has raised an Event that the message was received:"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot"),(0,i.kt)("img",{src:"./collateral/7-Faber-Basic-Msg.png",alt:"Faber Receive Message"})),(0,i.kt)("p",null,"Faber's controller application can take whatever action is necessary to process this message. It could trigger some application code, or it might just be something the Faber application needs to display to its user (for example a reminder about some action the user needs to take)."),(0,i.kt)("h3",{id:"alices-agent-verifies-that-faber-has-received-the-message"},"Alice's Agent Verifies that Faber has Received the Message"),(0,i.kt)("p",null,"How does Alice get feedback that Faber has received the message? The same way - when Faber's agent acknowledges receipt of the message, Alice's agent raises an Event to let the Alice controller know:"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot"),(0,i.kt)("img",{src:"./collateral/8-Alice-Basic-Msg.png",alt:"Alice Receive Message Confirmation"})),(0,i.kt)("p",null,"Again, Alice's agent can take whatever action is necessary, possibly just flagging the message as having been ",(0,i.kt)("inlineCode",{parentName:"p"},"received"),"."),(0,i.kt)("h2",{id:"preparing-to-issue-a-credential"},"Preparing to Issue a Credential"),(0,i.kt)("p",null,"The next thing we want to do in the demo is have the Faber agent issue a credential to Alice\u2019s agent. To this point, we have not used the Indy ledger at all. Establishing the connection and messaging has been done with pairwise DIDs based on the ",(0,i.kt)("inlineCode",{parentName:"p"},"did:peer")," method. Verifiable credentials must be rooted in a public DID ledger to enable the presentation of proofs."),(0,i.kt)("p",null,'Before the Faber agent can issue a credential, it must register a DID on the Indy public ledger, publish a schema, and create a credential definition. In the \u201creal world\u201d, the Faber agent would do this before connecting with any other agents. And, since we are using the handy "./run_demo faber" (and "./run_demo alice") scripts to start up our agents, the Faber version of the script has already:'),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"registered a public DID and stored it on the ledger;"),(0,i.kt)("li",{parentName:"ol"},"created a schema and registered it on the ledger;"),(0,i.kt)("li",{parentName:"ol"},"created a credential definition and registered it on the ledger.")),(0,i.kt)("p",null,"The schema and credential definition could also be created through this swagger interface."),(0,i.kt)("p",null,"We don't cover the details of those actions in this tutorial, but there are other materials available that go through these details."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"To Do: Add a link to directions for doing this manually, and to where in the controller Python code this is done.")),(0,i.kt)("h3",{id:"confirming-your-schema-and-credential-definition"},"Confirming your Schema and Credential Definition"),(0,i.kt)("p",null,"You can confirm the schema and credential definition were published by going back to the Indy ledger browser tab using Faber's public DID. You may have saved that from a previous step, but if not here is an API call you can make to get that information. Using Faber's swagger page and scroll to the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /wallet/did/public"))," endpoint. Click on ",(0,i.kt)("inlineCode",{parentName:"p"},"Try it Out")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Execute")," and you will see Faber's public DID."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot"),(0,i.kt)("img",{src:"./collateral/C-1-Faber-DID-Public.png",alt:"Faber Public DID"})),(0,i.kt)("p",null,"On the ledger browser of the ",(0,i.kt)("a",{parentName:"p",href:"http://dev.greenlight.bcovrin.vonx.io"},"BCovrin ledger"),", click the ",(0,i.kt)("inlineCode",{parentName:"p"},"Domain")," page, refresh, and paste the Faber public DID into the ",(0,i.kt)("inlineCode",{parentName:"p"},"Filter:")," field:"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot"),(0,i.kt)("img",{src:"./collateral/C-2-Faber-Ledger-Search-0.png",alt:"Search Ledger by DID"})),(0,i.kt)("p",null,"The ledger browser should refresh and display the four (4) transactions on the ledger related to this DID:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"the initial DID registration"),(0,i.kt)("li",{parentName:"ul"},"registration of the DID endpoint (Faber is an issuer so it has a public endpoint)"),(0,i.kt)("li",{parentName:"ul"},"the registered schema"),(0,i.kt)("li",{parentName:"ul"},"the registered credential definition")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me the ledger transactions"),(0,i.kt)("img",{src:"./collateral/C-2-Faber-Ledger-Search-1.png",alt:"DID Transaction"}),(0,i.kt)("img",{src:"./collateral/C-2-Faber-Ledger-Search-2.png",alt:"DID Endpoint Transaction"}),(0,i.kt)("img",{src:"./collateral/C-2-Faber-Ledger-Search-3.png",alt:"Schema Transaction"}),(0,i.kt)("img",{src:"./collateral/C-2-Faber-Ledger-Search-4.png",alt:"Credential Definition Transaction"})),(0,i.kt)("p",null,"You can also look up the Schema and Credential Definition information using Faber's swagger page. Use the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /schemas/created"))," endpoint to get a list of schemas, including the one ",(0,i.kt)("inlineCode",{parentName:"p"},"schema_id")," that the Faber agent has defined. Keep this section of the Swagger page expanded as we'll need to copy the Id as part of starting the issue credential protocol coming next."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot"),(0,i.kt)("img",{src:"./collateral/C-3-Faber-Info-2.png",alt:"Search Schemas"}),(0,i.kt)("img",{src:"./collateral/C-3-Faber-Info-3.png",alt:"Search Schemas"})),(0,i.kt)("p",null,"Likewise use the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /credential-definitions/created"))," endpoint to get the list of the one (in this case) credential definition id created by Faber. Keep this section of the Swagger page expanded as we'll also need to copy the Id as part of starting the issue credential protocol coming next."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot"),(0,i.kt)("img",{src:"./collateral/C-3-Faber-Info-4.png",alt:"Search Credential Definitions"}),(0,i.kt)("img",{src:"./collateral/C-3-Faber-Info-5.png",alt:"Search Credential Definitions"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Hint"),": Remember how the schema and credential definitions were created for you as Faber started up? To do it yourself, use the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST"))," versions of these endpoints. Now you know!"),(0,i.kt)("h3",{id:"notes"},"Notes"),(0,i.kt)("p",null,"The one time setup work for issuing a credential is complete","\u2014",'creating a DID, schema and credential definition. We can now issue 1 or 1 million credentials without having to do those steps again. Astute readers might note that we did not setup a revocation registry, so we cannot revoke the credentials we issue with that credential definition. You can\u2019t have everything in an "easy" tutorial!'),(0,i.kt)("h2",{id:"issuing-a-credential"},"Issuing a Credential"),(0,i.kt)("p",null,"Triggering the issuance of a credential from the Faber agent to Alice\u2019s agent is done with another API call. In the Faber browser tab, scroll down to the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /issue-credential-2.0/send"))," and get ready to (but don\u2019t yet) execute the request. Before execution, you need to update most of the data elements in the JSON. We now cover how to update all the fields."),(0,i.kt)("h3",{id:"faber---preparing-to-issue-a-credential"},"Faber - Preparing to Issue a Credential"),(0,i.kt)("p",null,"First, get the connection Id for Faber's connection with Alice. You can copy that from the Faber terminal (the last received event includes it), or scroll up on the Faber swagger tab to the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /connections"))," API endpoint, execute, copy it and paste the ",(0,i.kt)("inlineCode",{parentName:"p"},"connection_id")," value into the same field in the issue credential JSON."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Click here to see a screenshot"),(0,i.kt)("img",{src:"./collateral/C-3-Faber-Info-1.png",alt:"Connection Id"})),(0,i.kt)("p",null,"For the following fields, scroll on Faber's Swagger page to the listed endpoint, execute (if necessary), copy the response value and paste as the values of the following JSON items:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"issuer_did")," the Faber public DID (use ",(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /wallet/DID/public")),"),"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"schema_id")," the Id of the schema Faber created (use ",(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /schemas/created")),") and,"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"cred_def_id")," the Id of the credential definition Faber created (use ",(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /credential-definitions/created")),")")),(0,i.kt)("p",null,"into the ",(0,i.kt)("inlineCode",{parentName:"p"},"filter")," section's ",(0,i.kt)("inlineCode",{parentName:"p"},"indy")," subsection. Remove the ",(0,i.kt)("inlineCode",{parentName:"p"},'"dif"')," subsection of the ",(0,i.kt)("inlineCode",{parentName:"p"},"filter")," section within the JSON, and specify the remaining indy filter criteria as follows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"schema_version"),": set to the last segment of the ",(0,i.kt)("inlineCode",{parentName:"li"},"schema_id"),", a three part version number that was randomly generated on startup of the Faber agent. Segments of the ",(0,i.kt)("inlineCode",{parentName:"li"},"schema_id"),' are separated by ":"s.'),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"schema_issuer_did"),": set to the same the value as in ",(0,i.kt)("inlineCode",{parentName:"li"},"issuer_did"),","),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"schema_name"),": set to the second last segment of the ",(0,i.kt)("inlineCode",{parentName:"li"},"schema_id"),", in this case ",(0,i.kt)("inlineCode",{parentName:"li"},"degree schema"))),(0,i.kt)("p",null,"Finally, set the remaining values as follows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"auto_remove"),": set to ",(0,i.kt)("inlineCode",{parentName:"li"},"true")," (no quotes), see note below"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"comment"),": set to any string. It's intended to let Alice know something about the credential being offered."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"trace"),": set to ",(0,i.kt)("inlineCode",{parentName:"li"},"false")," (no quotes). It's for troubleshooting, performance profiling, and/or diagnostics.")),(0,i.kt)("p",null,"By setting ",(0,i.kt)("inlineCode",{parentName:"p"},"auto_remove")," to true, ACA-Py will automatically remove the credential exchange record after the protocol completes. When implementing a controller, this is the likely setting to use to reduce agent storage usage, but implies if a record of the issuance of the credential is needed, the controller must save it somewhere else. For example, Faber College might extend their Student Information System, where they track all their students, to record when credentials are issued to students, and the Ids of the issued credentials."),(0,i.kt)("h3",{id:"faber---issuing-the-credential"},"Faber - Issuing the Credential"),(0,i.kt)("p",null,"Finally, we need put into the JSON the data values for the ",(0,i.kt)("inlineCode",{parentName:"p"},"credential_preview")," section of the JSON. Copy the following and paste it between the square brackets of the ",(0,i.kt)("inlineCode",{parentName:"p"},"attributes")," item, replacing what is there. Feel free to change the attribute ",(0,i.kt)("inlineCode",{parentName:"p"},"value")," items, but don't change the labels or names:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'      {\n        "name": "name",\n        "value": "Alice Smith"\n      },\n      {\n        "name": "timestamp",\n        "value": "1234567890"\n      },\n      {\n        "name": "date",\n        "value": "2018-05-28"\n      },\n      {\n        "name": "degree",\n        "value": "Maths"\n      },\n      {\n        "name": "birthdate_dateint",\n        "value": "19640101"\n      }\n')),(0,i.kt)("p",null,'(Note that the birthdate above is used to present later on to pass an "age proof".)'),(0,i.kt)("p",null,"OK, finally, you are ready to click ",(0,i.kt)("inlineCode",{parentName:"p"},"Execute"),". The request should work, but if it doesn\u2019t - check your JSON! Did you get all the quotes and commas right?"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - credential offer"),(0,i.kt)("img",{src:"./collateral/C-4-Faber-Credential-Offer-1.png",alt:"Faber Submit Credential Offer"}),(0,i.kt)("img",{src:"./collateral/C-4-Faber-Credential-Offer-2.png",alt:"Faber Submit Credential Offer"})),(0,i.kt)("p",null,"To confirm the issuance worked, scroll up on the Faber Swagger page to the ",(0,i.kt)("inlineCode",{parentName:"p"},"issue-credential v2.0")," section and execute the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /issue-credential-2.0/records"))," endpoint. You should see a lot of information about the exchange just initiated."),(0,i.kt)("h3",{id:"alice-receives-credential"},"Alice Receives Credential"),(0,i.kt)("p",null,"Let\u2019s look at it from Alice\u2019s side. Alice's agent source code automatically handles credential offers by immediately responding with a credential request. Scroll back in the Alice terminal to where the credential issuance started. If you've followed the full script, that is just after where we used the basic message protocol to send text messages between Alice and Faber."),(0,i.kt)("p",null,"Alice's agent first received a notification of a Credential Offer, to which it responded with a Credential Request. Faber received the Credential Request and responded in turn with an Issue Credential message. Scroll down through the events from ACA-Py to the controller to see the notifications of those messages. Make sure you scroll all the way to the bottom of the terminal so you can continue with the process."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - issue credential"),(0,i.kt)("img",{src:"./collateral/C-5-Alice-Credential-Offer-1.png",alt:"Issue Credential"})),(0,i.kt)("h3",{id:"alice-stores-credential-in-her-wallet"},"Alice Stores Credential in her Wallet"),(0,i.kt)("p",null,"We can check (via Alice's Swagger interface) the issue credential status by hitting the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /issue-credential-2.0/records"))," endpoint. Note that within the results, the ",(0,i.kt)("inlineCode",{parentName:"p"},"cred_ex_record")," just received has a ",(0,i.kt)("inlineCode",{parentName:"p"},"state")," of ",(0,i.kt)("inlineCode",{parentName:"p"},"credential-received"),", but not yet ",(0,i.kt)("inlineCode",{parentName:"p"},"done"),". Let's address that."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - check credential exchange status"),(0,i.kt)("img",{src:"./collateral/C-7-Alice-Store-Credential-1.png",alt:""}),(0,i.kt)("img",{src:"./collateral/C-7-Alice-Store-Credential-2.png",alt:""})),(0,i.kt)("p",null,"First, we need the ",(0,i.kt)("inlineCode",{parentName:"p"},"cred_ex_id")," from the API call response above, or from the event in the terminal; use the endpoint ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /issue-credential-2.0/records/{cred_ex_id}/store"))," to tell Alice's ACA-Py instance to store the credential in agent storage (aka the Indy Wallet). Note that in the JSON for that endpoint we can provide a credential Id to store in the wallet by setting a value in the ",(0,i.kt)("inlineCode",{parentName:"p"},"credential_id")," string. A real controller might use the ",(0,i.kt)("inlineCode",{parentName:"p"},"cred_ex_id")," for that, or use something else that makes sense in the agent's business scenario (but the agent generates a random credential identifier by default)."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - store credential"),(0,i.kt)("img",{src:"./collateral/C-7-Alice-Store-Credential-3.png",alt:""}),(0,i.kt)("img",{src:"./collateral/C-7-Alice-Store-Credential-4.png",alt:""})),(0,i.kt)("p",null,"Now, in Alice\u2019s swagger browser tab, find the ",(0,i.kt)("inlineCode",{parentName:"p"},"credentials")," section and within that, execute the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /credentials"))," endpoint. There should be a list of credentials held by Alice, with just a single entry, the credential issued from the Faber agent. Note that the element ",(0,i.kt)("inlineCode",{parentName:"p"},"referent")," is the value of the ",(0,i.kt)("inlineCode",{parentName:"p"},"credential_id")," element used in other calls. ",(0,i.kt)("inlineCode",{parentName:"p"},"referent")," is the name returned in the ",(0,i.kt)("inlineCode",{parentName:"p"},"indy-sdk")," call to get the set of credentials for the wallet and ACA-Py code does not change it in the response."),(0,i.kt)("h3",{id:"faber-receives-acknowledgment-that-the-credential-was-received"},"Faber Receives Acknowledgment that the Credential was Received"),(0,i.kt)("p",null,"On the Faber side, we can see by scanning back in the terminal that it receive events to notify that the credential was issued and accepted."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me Faber's event activity"),(0,i.kt)("img",{src:"./collateral/C-6-Faber-Credential-Request.png",alt:""}),(0,i.kt)("img",{src:"./collateral/C-8-Faber-Credential-Ack-0.png",alt:""})),(0,i.kt)("p",null,"Note that once the credential processing completed, Faber's agent deleted the credential exchange record from its wallet. This can be confirmed by executing the endpoint ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /issue-credential-2.0/records"))),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot"),(0,i.kt)("img",{src:"./collateral/C-8-Faber-Credential-Ack-1.png",alt:""}),(0,i.kt)("img",{src:"./collateral/C-8-Faber-Credential-Ack-2.png",alt:""})),(0,i.kt)("p",null,"You\u2019ve done it, issued a credential! w00t!"),(0,i.kt)("h3",{id:"issue-credential-notes"},"Issue Credential Notes"),(0,i.kt)("p",null,"Those that know something about the Indy process for issuing a credential and the DIDComm ",(0,i.kt)("inlineCode",{parentName:"p"},"Issue Credential")," protocol know that there multiple steps to issuing credentials, a back and forth between the issuer and the holder to (at least) offer, request and issue the credential. All of those messages happened, but the two agents took care of those details rather than bothering the controller (you, in this case) with managing the back and forth."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"On the Faber agent side, this is because we used the ",(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /issue-credential-2.0/send"))," administrative message, which handles the back and forth for the issuer automatically. We could have used the other ",(0,i.kt)("inlineCode",{parentName:"li"},"/issue-credential-2.0/")," endpoints to allow the controller to handle each step of the protocol."),(0,i.kt)("li",{parentName:"ul"},"On Alice's agent side, this is because the handler for the ",(0,i.kt)("inlineCode",{parentName:"li"},"issue_credential_v2_0")," event always responds to credential offers with corresponding credential requests.")),(0,i.kt)("h3",{id:"bonus-points"},"Bonus Points"),(0,i.kt)("p",null,"If you would like to perform all of the issuance steps manually on the Faber agent side, use a sequence of the other ",(0,i.kt)("inlineCode",{parentName:"p"},"/issue-credential-2.0/")," messages. Use the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /issue-credential-2.0/records"))," to both check the credential exchange state as you progress through the protocol and to find some of the data you\u2019ll need in executing the sequence of requests."),(0,i.kt)("p",null,'The following table lists endpoints that you need to call ("REST service") and callbacks that your agent will receive ("callback") that your need to respond to. See the ',(0,i.kt)("a",{parentName:"p",href:"../AdminAPI.md"},"detailed API docs"),"."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Protocol Step"),(0,i.kt)("th",{parentName:"tr",align:null},"Faber (Issuer)"),(0,i.kt)("th",{parentName:"tr",align:null},"Alice (Holder)"),(0,i.kt)("th",{parentName:"tr",align:null},"Notes"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Send Credential Offer"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /issue-credential-2.0/send-offer"))),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"REST service")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Receive Offer"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"<agent_cb>/issue_credential_v2_0/"),(0,i.kt)("td",{parentName:"tr",align:null},"callback")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Send Credential Request"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /issue-credential-2.0/records/{cred_ex_id}/send-request"))),(0,i.kt)("td",{parentName:"tr",align:null},"REST service")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Receive Request"),(0,i.kt)("td",{parentName:"tr",align:null},"<agent_cb>/issue_credential_v2_0/"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"callback")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Issue Credential"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /issue-credential-2.0/records/{cred_ex_id}/issue"))),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"REST service")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Receive Credential"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"<agent_cb>/issue_credential_v2_0/"),(0,i.kt)("td",{parentName:"tr",align:null},"callback")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Store Credential"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /issue-credential-2.0/records/{cred_ex_id}/store"))),(0,i.kt)("td",{parentName:"tr",align:null},"REST service")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Receive Acknowledgement"),(0,i.kt)("td",{parentName:"tr",align:null},"<agent_cb>/issue_credential_v2_0/"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"callback")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Store Credential Id"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"application function")))),(0,i.kt)("h2",{id:"requestingpresenting-a-proof"},"Requesting/Presenting a Proof"),(0,i.kt)("p",null,"Alice now has her Faber credential. Let\u2019s have the Faber agent send a request for a presentation (a proof) using that credential. This should be pretty easy for you at this point."),(0,i.kt)("h3",{id:"faber-sends-a-proof-request"},"Faber sends a Proof Request"),(0,i.kt)("p",null,"From the Faber browser tab, get ready to execute the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /present-proof-2.0/send-request"))," endpoint. After hitting ",(0,i.kt)("inlineCode",{parentName:"p"},"Try it Now"),', erase the data in the block labelled "Edit Value Model", replacing it with the text below. Once that is done, replace in the JSON each instance of ',(0,i.kt)("inlineCode",{parentName:"p"},"cred_def_id")," (there are four instances) and ",(0,i.kt)("inlineCode",{parentName:"p"},"connection_id")," with the values found using the same techniques we've used earlier in this tutorial. Both can be found by scrolling back a little in the Faber terminal, or you can execute API endpoints we've already covered. You can also change the value of the ",(0,i.kt)("inlineCode",{parentName:"p"},"comment")," item to whatever you want."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsonc"},'{\n  "comment": "This is a comment about the reason for the proof",\n  "connection_id": "e469e0f3-2b4d-4b12-9ac7-293f23e8a816",\n  "presentation_request": {\n    "indy": {\n      "name": "Proof of Education",\n      "version": "1.0",\n      "requested_attributes": {\n        "0_name_uuid": {\n          "name": "name",\n          "restrictions": [\n            {\n              "cred_def_id": "SsX9siFWXJyCAmXnHY514N:3:CL:8:faber.agent.degree_schema"\n            }\n          ]\n        },\n        "0_date_uuid": {\n          "name": "date",\n          "restrictions": [\n            {\n              "cred_def_id": "SsX9siFWXJyCAmXnHY514N:3:CL:8:faber.agent.degree_schema"\n            }\n          ]\n        },\n        "0_degree_uuid": {\n          "name": "degree",\n          "restrictions": [\n            {\n              "cred_def_id": "SsX9siFWXJyCAmXnHY514N:3:CL:8:faber.agent.degree_schema"\n            }\n          ]\n        },\n        "0_self_attested_thing_uuid": {\n          "name": "self_attested_thing"\n        }\n      },\n      "requested_predicates": {\n        "0_age_GE_uuid": {\n          "name": "birthdate_dateint",\n          "p_type": "<=",\n          "p_value": 20030101,\n          "restrictions": [\n            {\n              "cred_def_id": "SsX9siFWXJyCAmXnHY514N:3:CL:8:faber.agent.degree_schema"\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",null,'(Note that the birthdate requested above is used as an "age proof", the calculation is something like ',(0,i.kt)("inlineCode",{parentName:"p"},"now() - years(18)"),", and the presented birthdate must be on or before this date. You can see the calculation in action in the ",(0,i.kt)("inlineCode",{parentName:"p"},"faber.py")," demo code.)"),(0,i.kt)("p",null,"Notice that the proof request is using a predicate to check if Alice is older than 18 without asking for her age. Not sure what this has to do with her education level! Click ",(0,i.kt)("inlineCode",{parentName:"p"},"Execute")," and cross your fingers. If the request fails check your JSON!"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me a screenshot - send proof request"),(0,i.kt)("img",{src:"./collateral/P-1-Faber-Proof-Request-1.png",alt:"Send Proof Request"}),(0,i.kt)("img",{src:"./collateral/P-1-Faber-Proof-Request-2.png",alt:"Send Proof Request"})),(0,i.kt)("h3",{id:"alice---responding-to-the-proof-request"},"Alice - Responding to the Proof Request"),(0,i.kt)("p",null,"As before, Alice receives a webhook event from her agent telling her she has received a Proof Request. In our scenario, the ACA-Py instance automatically selects a matching credential and responds with a Proof."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me Alice's event activity"),(0,i.kt)("img",{src:"./collateral/P-2-Alice-Proof-Request-1.png",alt:"Proof Request"}),(0,i.kt)("img",{src:"./collateral/P-2-Alice-Proof-Request-2.png",alt:"Proof Request"})),(0,i.kt)("p",null,"In a real scenario, for example if Alice had a mobile agent on her smartphone, the agent would prompt Alice whether she wanted to respond or not."),(0,i.kt)("h3",{id:"faber---verifying-the-proof"},"Faber - Verifying the Proof"),(0,i.kt)("p",null,"Note that in the response, the state is ",(0,i.kt)("inlineCode",{parentName:"p"},"request-sent"),". That is because when the HTTP response was generated (immediately after sending the request), Alice's agent had not yet responded to the request. We\u2019ll have to do another request to verify the presentation worked. Copy the value of the ",(0,i.kt)("inlineCode",{parentName:"p"},"pres_ex_id")," field from the event in the Faber terminal and use it in executing the ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /present-proof-2.0/records/{pres_ex_id}"))," endpoint. That should return a result showing the ",(0,i.kt)("inlineCode",{parentName:"p"},"state")," as ",(0,i.kt)("inlineCode",{parentName:"p"},"done")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"verified")," as ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),". Proof positive!"),(0,i.kt)("p",null,"You can see some of Faber's activity below:"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Show me Faber's event activity"),(0,i.kt)("img",{src:"./collateral/P-3-Faber-Proof-1.png",alt:"Receive and Verify Proof"}),(0,i.kt)("img",{src:"./collateral/P-3-Faber-Proof-2.png",alt:"Receive and Verify Proof"}),(0,i.kt)("img",{src:"./collateral/P-3-Faber-Proof-3.png",alt:"Receive and Verify Proof"})),(0,i.kt)("h3",{id:"present-proof-notes"},"Present Proof Notes"),(0,i.kt)("p",null,"As with the issue credential process, the agents handled some of the presentation steps without bothering the controller. In this case, Alice's agent processed the presentation request automatically through its handler for the ",(0,i.kt)("inlineCode",{parentName:"p"},"present_proof_v2_0")," event, and her wallet contained exactly one credential that satisfied the presentation-request from the Faber agent. Similarly, the Faber agent's handler for the event responds automatically and so on receipt of the presentation, it verified the presentation and updated the status accordingly."),(0,i.kt)("h3",{id:"bonus-points-1"},"Bonus Points"),(0,i.kt)("p",null,"If you would like to perform all of the proof request/response steps manually, you can call all of the individual ",(0,i.kt)("inlineCode",{parentName:"p"},"/present-proof-2.0")," messages."),(0,i.kt)("p",null,'The following table lists endpoints that you need to call ("REST service") and callbacks that your agent will receive ("callback") that your need to respond to. See the ',(0,i.kt)("a",{parentName:"p",href:"../AdminAPI.md"},"detailed API docs"),"."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Protocol Step"),(0,i.kt)("th",{parentName:"tr",align:null},"Faber (Verifier)"),(0,i.kt)("th",{parentName:"tr",align:null},"Alice (Holder/Prover)"),(0,i.kt)("th",{parentName:"tr",align:null},"Notes"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Send Proof Request"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /present-proof-2.0/send-request"))),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"REST service")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Receive Proof Request"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"<agent_cb>/present_proof_v2_0"),(0,i.kt)("td",{parentName:"tr",align:null},"callback")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Find Credentials"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},(0,i.kt)("inlineCode",{parentName:"strong"},"GET /present-proof-2.0/records/{pres_ex_id}/credentials"))),(0,i.kt)("td",{parentName:"tr",align:null},"REST service")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Select Credentials"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"application or user function")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Send Proof"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /present-proof-2.0/records/{pres_ex_id}/send-presentation"))),(0,i.kt)("td",{parentName:"tr",align:null},"REST service")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Receive Proof"),(0,i.kt)("td",{parentName:"tr",align:null},"<agent_cb>/present_proof_v2_0"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"callback")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Validate Proof"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},(0,i.kt)("inlineCode",{parentName:"strong"},"POST /present-proof-2.0/records/{pres_ex_id}/verify-presentation"))),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"REST service")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Save Proof"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"application data")))),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"That\u2019s the OpenAPI-based tutorial. Feel free to play with the API and learn how it works. More importantly, as you implement a controller, use the OpenAPI user interface to test out the calls you will be using as you go. The list of API calls is grouped by protocol and if you are familiar with the protocols (Aries RFCs) the API call names should be pretty obvious."),(0,i.kt)("p",null,"One limitation of you being the controller is that you don't see the events from the agent that a controller program sees. For example, you, as Alice's agent, are not notified when Faber initiates the sending of a Credential. Some of those things show up in the terminal as messages, but others you just have to know have happened based on a successful API call."))}p.isMDXComponent=!0}}]);