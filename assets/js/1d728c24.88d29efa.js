"use strict";(self.webpackChunkaries_cloud_agent_python_documentation=self.webpackChunkaries_cloud_agent_python_documentation||[]).push([[3530],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(a),g=r,m=u["".concat(l,".").concat(g)]||u[g]||d[g]||s;return a?n.createElement(m,i(i({ref:t},c),{},{components:a})):n.createElement(m,i({ref:t},c))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,i=new Array(s);i[0]=g;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[u]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<s;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},1619:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const s={},i="Integration Tests for Aca-py using Behave",o={unversionedId:"demo/INTEGRATION-TESTS",id:"demo/INTEGRATION-TESTS",title:"Integration Tests for Aca-py using Behave",description:"Integration tests for aca-py are implemented using Behave functional tests to drive aca-py agents based on the alice/faber demo framework.",source:"@site/docs/demo/INTEGRATION-TESTS.md",sourceDirName:"demo",slug:"/demo/INTEGRATION-TESTS",permalink:"/aries-acapy-docs/demo/INTEGRATION-TESTS",draft:!1,editUrl:"https://github.com/hyperledger/aries-acapy-docs/tree/main/docs/docusaurus/docs/demo/INTEGRATION-TESTS.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Endorser Demo",permalink:"/aries-acapy-docs/demo/Endorser"},next:{title:"Becoming an Indy/Aries Developer",permalink:"/aries-acapy-docs/developer/"}},l={},p=[{value:"Running Integration Tests which require TAA",id:"running-integration-tests-which-require-taa",level:2},{value:"Aca-py Integration Tests vs Aries Agent Test Harness (AATH)",id:"aca-py-integration-tests-vs-aries-agent-test-harness-aath",level:2},{value:"Configuration-driven Tests",id:"configuration-driven-tests",level:2},{value:"Global Configuration for All Aca-py Agents Under Test",id:"global-configuration-for-all-aca-py-agents-under-test",level:2},{value:"Specifying Environment Parameters when Running Integration Tests",id:"specifying-environment-parameters-when-running-integration-tests",level:2},{value:"Running specific test scenarios",id:"running-specific-test-scenarios",level:2}],c={toc:p},u="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(u,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"integration-tests-for-aca-py-using-behave"},"Integration Tests for Aca-py using Behave"),(0,r.kt)("p",null,"Integration tests for aca-py are implemented using Behave functional tests to drive aca-py agents based on the alice/faber demo framework."),(0,r.kt)("p",null,"To run the aca-py Behave tests, open a bash shell run the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/bcgov/von-network\ncd von-network\n./manage build\n./manage start\ncd ..\ngit clone https://github.com/bcgov/indy-tails-server.git\ncd indy-tails-server/docker\n./manage build\n./manage start\ncd ../..\ngit clone https://github.com/hyperledger/aries-cloudagent-python\ncd aries-cloudagent-python/demo\n./run_bdd -t ~@taa_required\n")),(0,r.kt)("p",null,"Note that an Indy ledger and tails server are both required (these can also be specified using environment variables)."),(0,r.kt)("p",null,"Note also that some tests require a ledger with TAA enabled, how to run these tests will be described later."),(0,r.kt)("p",null,"By default the test suite runs using a default (SQLite) wallet, to run the tests using postgres run the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# run the above commands, up to cd aries-cloudagent-python/demo\ndocker run --name some-postgres -e POSTGRES_PASSWORD=mysecretpassword -d -p 5432:5432 postgres:10\nACAPY_ARG_FILE=postgres-indy-args.yml ./run_bdd\n")),(0,r.kt)("p",null,"To run the tests against the back-end ",(0,r.kt)("inlineCode",{parentName:"p"},"askar")," libraries (as opposed to indy-sdk) run the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'BDD_EXTRA_AGENT_ARGS="{\\"wallet-type\\":\\"askar\\"}" ./run_bdd -t ~@taa_required\n')),(0,r.kt)("p",null,"(Note that ",(0,r.kt)("inlineCode",{parentName:"p"},"wallet-type")," is currently the only extra argument supported.)"),(0,r.kt)("p",null,"You can run individual tests by specifying the tag(s):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./run_bdd -t @T001-AIP10-RFC0037\n")),(0,r.kt)("h2",{id:"running-integration-tests-which-require-taa"},"Running Integration Tests which require TAA"),(0,r.kt)("p",null,"To run a local von-network with TAA enabled,run the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/bcgov/von-network\ncd von-network\n./manage build\n./manage start --taa-sample --logs\n")),(0,r.kt)("p",null,"You can then run the TAA-enabled tests as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./run_bdd -t @taa_required\n")),(0,r.kt)("p",null,"or:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'BDD_EXTRA_AGENT_ARGS="{\\"wallet-type\\":\\"askar\\"}" ./run_bdd -t @taa_required\n')),(0,r.kt)("h2",{id:"aca-py-integration-tests-vs-aries-agent-test-harness-aath"},"Aca-py Integration Tests vs Aries Agent Test Harness (AATH)"),(0,r.kt)("p",null,"Aca-py Behave tests are based on the interoperability tests that are implemented in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-agent-test-harness"},"Aries Agent Test Harness (AATH)"),".  Both use ",(0,r.kt)("a",{parentName:"p",href:"https://behave.readthedocs.io/en/stable/"},"Behave (Gherkin)")," to execute tests against a running aca-py agent (or in the case of AATH, against any compatible Aries agent), however the aca-py integration tests focus on aca-py specific features."),(0,r.kt)("p",null,"AATH:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Main purpose is to test interoperability between Aries agents"),(0,r.kt)("li",{parentName:"ul"},"Implements detailed tests based on ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/hyperledger/aries-rfcs"},"Aries RFC's")," (runs different scenarios, tests exception paths, etc.)"),(0,r.kt)("li",{parentName:"ul"},"Runs Aries agents using Docker images (agents run for the duration of the tests)"),(0,r.kt)("li",{parentName:"ul"},'Uses a standard "backchannel" to support integration of any Aries agent')),(0,r.kt)("p",null,"Aca-py integration tests:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Main purpose is to test aca-py"),(0,r.kt)("li",{parentName:"ul"},"Implements tests based on Aries RFC's, but not to the level of detail as AATH (runs (mostly) happy path scenarios against multiple agent configurations)"),(0,r.kt)("li",{parentName:"ul"},"Tests aca-py specific configurations and features"),(0,r.kt)("li",{parentName:"ul"},"Starts and stops agents for each tests to test different aca-py configurations"),(0,r.kt)("li",{parentName:"ul"},"Uses the same Python framework as used for the interactive Alice/Faber demo")),(0,r.kt)("h2",{id:"configuration-driven-tests"},"Configuration-driven Tests"),(0,r.kt)("p",null,"Aca-py integration tests use the same configuration approach as AATH, documented ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-agent-test-harness/blob/master/CONFIGURE-CRED-TYPES.md"},"here"),"."),(0,r.kt)("p",null,"In addition to support for external schemas, credential data etc, the aca-py integration tests support configuration of the aca-py agents that are used to run the test.  For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'Scenario Outline: Present Proof where the prover does not propose a presentation of the proof and is acknowledged\n  Given "3" agents\n     | name  | role     | capabilities        |\n     | Acme  | issuer   | <Acme_capabilities> |\n     | Faber | verifier | <Acme_capabilities> |\n     | Bob   | prover   | <Bob_capabilities>  |\n  And "<issuer>" and "Bob" have an existing connection\n  And "Bob" has an issued <Schema_name> credential <Credential_data> from <issuer>\n  ...\n\n  Examples:\n     | issuer | Acme_capabilities        | Bob_capabilities | Schema_name    | Credential_data          | Proof_request  |\n     | Acme   | --public-did             |                  | driverslicense | Data_DL_NormalizedValues | DL_age_over_19 |\n     | Faber  | --public-did  --mediator | --mediator       | driverslicense | Data_DL_NormalizedValues | DL_age_over_19 |\n')),(0,r.kt)("p",null,'In the above example, the test will run twice using the parameters specified in the "Examples" section.  The Acme, Faber and Bob agents will be started for the test and then shut down when the test is completed.'),(0,r.kt)("p",null,'The agent\'s "capabilities" are specified using the same command-line parameters that are supported for the Alice/Faber demo agents.'),(0,r.kt)("h2",{id:"global-configuration-for-all-aca-py-agents-under-test"},"Global Configuration for All Aca-py Agents Under Test"),(0,r.kt)("p",null,"You can specify parameters that are applied to all aca-py agents using the ",(0,r.kt)("inlineCode",{parentName:"p"},"ACAPY_ARG_FILE")," environment variable, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ACAPY_ARG_FILE=postgres-indy-args.yml ./run_bdd\n")),(0,r.kt)("p",null,"... will apply the parameters in the ",(0,r.kt)("inlineCode",{parentName:"p"},"postgres-indy-args.yml")," file (which just happens to configure a postgres wallet) to ",(0,r.kt)("em",{parentName:"p"},"all")," agents under test."),(0,r.kt)("p",null,"Or the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ACAPY_ARG_FILE=askar-indy-args.yml ./run_bdd\n")),(0,r.kt)("p",null,"... will run all the tests against an askar wallet (the new shared components, which replace indy-sdk)."),(0,r.kt)("p",null,"Any aca-py arguement can be included in the yml file, and order-of-precidence applies (see ",(0,r.kt)("a",{parentName:"p",href:"https://pypi.org/project/ConfigArgParse/"},"https://pypi.org/project/ConfigArgParse/"),")."),(0,r.kt)("h2",{id:"specifying-environment-parameters-when-running-integration-tests"},"Specifying Environment Parameters when Running Integration Tests"),(0,r.kt)("p",null,"Aca-py integration tests support the following environment-driven configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"LEDGER_URL")," - specify the ledger url"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"TAILS_NETWORK")," - specify the docker network the tailer server is running on"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"PUBLIC_TAILS_URL")," - specify the public url of the tails server"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ACAPY_ARG_FILE")," - specify global aca-py parameters (see above)")),(0,r.kt)("h2",{id:"running-specific-test-scenarios"},"Running specific test scenarios"),(0,r.kt)("p",null,"Behave tests are tagged using the same ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-agent-test-harness#test-tags"},"standard tags as used in AATH"),"."),(0,r.kt)("p",null,"To run a specific set of Aca-py integration tests (or exclude specific tests):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./run_bdd -t tag1 -t ~tag2\n")),(0,r.kt)("p",null,"(All command line parameters are passed to the ",(0,r.kt)("inlineCode",{parentName:"p"},"behave")," command, so ",(0,r.kt)("a",{parentName:"p",href:"https://behave.readthedocs.io/en/stable/behave.html"},"all parameters supported by behave")," can be used.)"))}d.isMDXComponent=!0}}]);