"use strict";(self.webpackChunkaries_cloud_agent_python_documentation=self.webpackChunkaries_cloud_agent_python_documentation||[]).push([[4321],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(n),u=o,m=c["".concat(s,".").concat(u)]||c[u]||h[u]||r;return n?a.createElement(m,i(i({ref:t},p),{},{components:n})):a.createElement(m,i({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:o,i[1]=l;for(var d=2;d<r;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3736:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var a=n(7462),o=(n(7294),n(3905));const r={title:"Aries Cloud Agent Python (ACA-Py) Demos"},i="Aries Cloud Agent Python (ACA-Py) Demos \x3c!-- omit in toc --\x3e",l={unversionedId:"demo/README",id:"demo/README",title:"Aries Cloud Agent Python (ACA-Py) Demos",description:"There are several demos available for ACA-Py mostly (but not only) aimed at developers learning how to deploy an instance of the agent and an ACA-Py controller to implement an application.",source:"@site/docs/demo/README.md",sourceDirName:"demo",slug:"/demo/",permalink:"/aries-acapy-docs/demo/",draft:!1,editUrl:"https://github.com/hyperledger/aries-acapy-docs/tree/main/docs/docusaurus/docs/demo/README.md",tags:[],version:"current",frontMatter:{title:"Aries Cloud Agent Python (ACA-Py) Demos"},sidebar:"tutorialSidebar",previous:{title:"aries_cloudagent",permalink:"/aries-acapy-docs/code/generated/modules"},next:{title:"Acme Controller Workshop",permalink:"/aries-acapy-docs/demo/AcmeDemoWorkshop"}},s={},d=[{value:"Table of Contents  omit in toc ",id:"table-of-contents--omit-in-toc-",level:2},{value:"The IIWBook Demo",id:"the-iiwbook-demo",level:2},{value:"The Alice/Faber Python demo",id:"the-alicefaber-python-demo",level:2},{value:"Running in a Browser",id:"running-in-a-browser",level:3},{value:"Running in Docker",id:"running-in-docker",level:3},{value:"Running Locally",id:"running-locally",level:3},{value:"Installing Prerequisites",id:"installing-prerequisites",level:4},{value:"Start a local indy ledger",id:"start-a-local-indy-ledger",level:4},{value:"Genesis File handling",id:"genesis-file-handling",level:4},{value:"Run a local Postgres instance",id:"run-a-local-postgres-instance",level:4},{value:"Optional: Run a von-network ledger browser",id:"optional-run-a-von-network-ledger-browser",level:4},{value:"Run the Alice and Faber Controllers/Agents",id:"run-the-alice-and-faber-controllersagents",level:4},{value:"Follow The Script",id:"follow-the-script",level:3},{value:"Exchanging Messages",id:"exchanging-messages",level:4},{value:"Issuing and Proving Credentials",id:"issuing-and-proving-credentials",level:4},{value:"Additional Options in the Alice/Faber demo",id:"additional-options-in-the-alicefaber-demo",level:2},{value:"Revocation",id:"revocation",level:3},{value:"DID Exchange",id:"did-exchange",level:3},{value:"Endorser",id:"endorser",level:3},{value:"Run Indy-SDK Backend",id:"run-indy-sdk-backend",level:3},{value:"Mediation",id:"mediation",level:3},{value:"Multi-tenancy",id:"multi-tenancy",level:3},{value:"Multi-ledger",id:"multi-ledger",level:3},{value:"Multi-tenancy <em>with Mediation</em>!!!",id:"multi-tenancy-with-mediation",level:3},{value:"Learning about the Alice/Faber code",id:"learning-about-the-alicefaber-code",level:2},{value:"OpenAPI (Swagger) Demo",id:"openapi-swagger-demo",level:2},{value:"Performance Demo",id:"performance-demo",level:2},{value:"Coding Challenge: Adding ACME",id:"coding-challenge-adding-acme",level:2}],p={toc:d},c="wrapper";function h(e){let{components:t,...n}=e;return(0,o.kt)(c,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"aries-cloud-agent-python-aca-py-demos--omit-in-toc-"},"Aries Cloud Agent Python (ACA-Py) Demos "),(0,o.kt)("p",null,"There are several demos available for ACA-Py mostly (but not only) aimed at developers learning how to deploy an instance of the agent and an ACA-Py controller to implement an application."),(0,o.kt)("h2",{id:"table-of-contents--omit-in-toc-"},"Table of Contents "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#the-iiwbook-demo"},"The IIWBook Demo")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#the-alicefaber-python-demo"},"The Alice/Faber Python demo"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#running-in-a-browser"},"Running in a Browser")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#running-in-docker"},"Running in Docker")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#running-locally"},"Running Locally"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#installing-prerequisites"},"Installing Prerequisites")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#start-a-local-indy-ledger"},"Start a local indy ledger")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#genesis-file-handling"},"Genesis File handling")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#run-a-local-postgres-instance"},"Run a local Postgres instance")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#optional-run-a-von-network-ledger-browser"},"Optional: Run a von-network ledger browser")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#run-the-alice-and-faber-controllersagents"},"Run the Alice and Faber Controllers/Agents")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#follow-the-script"},"Follow The Script"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#exchanging-messages"},"Exchanging Messages")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#issuing-and-proving-credentials"},"Issuing and Proving Credentials")))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#additional-options-in-the-alicefaber-demo"},"Additional Options in the Alice/Faber demo"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#revocation"},"Revocation")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#mediation"},"Mediation")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#multi-tenancy"},"Multi-tenancy")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#multi-ledger"},"Multi-ledger")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#did-exchange"},"DID Exchange")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#endorser"},"Endorser")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#run-indy-sdk-backend"},"Run Indy-SDK Backend")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#learning-about-the-alicefaber-code"},"Learning about the Alice/Faber code")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#openapi-swagger-demo"},"OpenAPI (Swagger) Demo")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#performance-demo"},"Performance Demo")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#coding-challenge-adding-acme"},"Coding Challenge: Adding ACME"))),(0,o.kt)("h2",{id:"the-iiwbook-demo"},"The IIWBook Demo"),(0,o.kt)("p",null,"The IIWBook demo is a real (play) self-sovereign identity demonstration. During the demo, you will get a mobile agent (sorry - IOS only right now), and use that agent to connect with several enterprise services to collect and prove credentials. The two services in the demo (the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/bcgov/indy-email-verification"},"email verification service")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/bcgov/iiwbook"},"IIWBook"),") are both instances of ACA-Py, and all the agents are using DIDComm to communicate. Learn about and run the demo at ",(0,o.kt)("a",{parentName:"p",href:"https://vonx.io/how_to/iiwbook"},"https://vonx.io/how_to/iiwbook"),". Developers, when you are ready, check out the code in the repos of the two services to see how they implement Django web server-based controller and agent."),(0,o.kt)("h2",{id:"the-alicefaber-python-demo"},"The Alice/Faber Python demo"),(0,o.kt)("p",null,'The Alice/Faber demo is the (in)famous first verifiable credentials demo. Alice, a former student of Faber College ("Knowledge is Good"), connects with the College, is issued a credential about her degree and then is asked by the College for a proof. There are a variety of ways of running the demo. The easiest is in your browser using a site ("Play with VON") that let\'s you run docker containers without installing anything. Alternatively, you can run locally on docker (our recommendation), or using python on your local machine. Each approach is covered below.'),(0,o.kt)("h3",{id:"running-in-a-browser"},"Running in a Browser"),(0,o.kt)("p",null,"In your browser, go to the docker playground service ",(0,o.kt)("a",{parentName:"p",href:"https://labs.play-with-docker.com/"},"Play with Docker"),'. On the title screen, click "Start". On the next screen, click (in the left menu) "+Add a new instance". That will start up a terminal in your browser. Run the following commands to start the Faber agent:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/hyperledger/aries-cloudagent-python\ncd aries-cloudagent-python/demo\nLEDGER_URL=http://dev.greenlight.bcovrin.vonx.io ./run_demo faber\n")),(0,o.kt)("p",null,"Now to start Alice's agent. Click the \"+Add a new instance\" button again to open another terminal session. Run the following commands to start Alice's agent:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/hyperledger/aries-cloudagent-python\ncd aries-cloudagent-python/demo\nLEDGER_URL=http://dev.greenlight.bcovrin.vonx.io ./run_demo alice\n")),(0,o.kt)("p",null,"Alice's agent is now running."),(0,o.kt)("p",null,"Jump to the ",(0,o.kt)("a",{parentName:"p",href:"#follow-the-script"},"Follow the Script")," section below for further instructions."),(0,o.kt)("h3",{id:"running-in-docker"},"Running in Docker"),(0,o.kt)("p",null,"Running the demo in docker requires having a ",(0,o.kt)("inlineCode",{parentName:"p"},"von-network")," (a Hyperledger Indy public ledger sandbox) instance running in docker locally. See the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/bcgov/von-network#running-the-network-locally"},"Running the Network Locally")," section of the ",(0,o.kt)("inlineCode",{parentName:"p"},"von-network")," readme file for more info."),(0,o.kt)("p",null,"Open three ",(0,o.kt)("inlineCode",{parentName:"p"},"bash")," shells. For Windows users, ",(0,o.kt)("inlineCode",{parentName:"p"},"git-bash")," is highly recommended. bash is the default shell in Linux and Mac terminal sessions."),(0,o.kt)("p",null,"In the first terminal window, start ",(0,o.kt)("inlineCode",{parentName:"p"},"von-network")," by following the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/bcgov/von-network#running-the-network-locally"},"Running the Network Locally")," instructions."),(0,o.kt)("p",null,"In the second terminal, change directory into ",(0,o.kt)("inlineCode",{parentName:"p"},"demo")," directory of your clone of this repository. Start the ",(0,o.kt)("inlineCode",{parentName:"p"},"faber")," agent by issuing the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"  ./run_demo faber\n")),(0,o.kt)("p",null,"In the third terminal, change directory into ",(0,o.kt)("inlineCode",{parentName:"p"},"demo")," directory of your clone of this repository. Start the ",(0,o.kt)("inlineCode",{parentName:"p"},"alice")," agent by issuing the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"  ./run_demo alice\n")),(0,o.kt)("p",null,"Jump to the ",(0,o.kt)("a",{parentName:"p",href:"#follow-the-script"},"Follow the Script")," section below for further instructions."),(0,o.kt)("h3",{id:"running-locally"},"Running Locally"),(0,o.kt)("p",null,"The following is an approach to to running the Alice and Faber demo using Python3 running on a bare machine. There are other ways to run the components, but this covers the general approach."),(0,o.kt)("h4",{id:"installing-prerequisites"},"Installing Prerequisites"),(0,o.kt)("p",null,"We assume you have a running Python 3 environment. To install the prerequisites specific to running the agent/controller examples in your Python environment, run the following command from this repo's ",(0,o.kt)("inlineCode",{parentName:"p"},"demo")," folder. The precise command to run may vary based on your Python environment setup."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"pip3 install -r demo/requirements.txt\n")),(0,o.kt)("p",null,"While that process will include the installation of the Indy python prerequisite, you still have to build and install the ",(0,o.kt)("inlineCode",{parentName:"p"},"libindy")," code for your platform. Follow the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/indy-sdk#installing-the-sdk"},"installation instructions")," in the indy-sdk repo for your platform."),(0,o.kt)("h4",{id:"start-a-local-indy-ledger"},"Start a local indy ledger"),(0,o.kt)("p",null,"Use instructions in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/indy-sdk#how-to-start-local-nodes-pool-with-docker"},"indy-sdk repo")," to run a local ledger."),(0,o.kt)("h4",{id:"genesis-file-handling"},"Genesis File handling"),(0,o.kt)("p",null,"An Aries agent (or other client) connecting to an Indy ledger must know the contents of the ",(0,o.kt)("inlineCode",{parentName:"p"},"genesis")," file for the ledger. The genesis file lets the agent/client know the IP addresses of the initial nodes of the ledger, and the agent/client sends ledger requests to those IP addresses. When using the ",(0,o.kt)("inlineCode",{parentName:"p"},"indy-sdk")," ledger, look for the instructions in that repo for how to find/update the ledger genesis file, and note the path to that file on your local system."),(0,o.kt)("p",null,"The envrionment variable ",(0,o.kt)("inlineCode",{parentName:"p"},"GENESIS_FILE")," is used to let the Aries demo agents know the location of the genesis file. Use the path to that file as value of the ",(0,o.kt)("inlineCode",{parentName:"p"},"GENESIS_FILE")," environment variable in the instructions below. You might want to copy that file to be local to the demo so the path is shorter."),(0,o.kt)("h4",{id:"run-a-local-postgres-instance"},"Run a local Postgres instance"),(0,o.kt)("p",null,"The demo uses the postgres database the wallet persistence. Use the Docker Hub certified postgres image to start up a postgres instance to be used for the wallet storage:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker run --name some-postgres -e POSTGRES_PASSWORD=mysecretpassword -d -p 5432:5432 postgres -c 'log_statement=all' -c 'logging_collector=on' -c 'log_destination=stderr'\n")),(0,o.kt)("h4",{id:"optional-run-a-von-network-ledger-browser"},"Optional: Run a von-network ledger browser"),(0,o.kt)("p",null,"If you want to be able to browse your local ledger as you run the demo, clone the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/bcgov/von-network"},"von-network")," repo, go into the root of the cloned instance and run the following command, replacing the ",(0,o.kt)("inlineCode",{parentName:"p"},"/path/to/local-genesis.txt")," with a path to the same genesis file as was used in starting the ledger."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"GENESIS_FILE=/path/to/local-genesis.txt PORT=9000 REGISTER_NEW_DIDS=true python -m server.server\n")),(0,o.kt)("h4",{id:"run-the-alice-and-faber-controllersagents"},"Run the Alice and Faber Controllers/Agents"),(0,o.kt)("p",null,"With the rest of the pieces running, you can run the Alice and Faber controllers and agents. To do so, ",(0,o.kt)("inlineCode",{parentName:"p"},"cd")," into the ",(0,o.kt)("inlineCode",{parentName:"p"},"demo")," folder your clone of this repo in two terminal windows and run the following, replacing the ",(0,o.kt)("inlineCode",{parentName:"p"},"/path/to/local-genesis.txt"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"GENESIS_FILE=/path/to/local-genesis.txt DEFAULT_POSTGRES=true python3 -m runners.faber --port 8020\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"GENESIS_FILE=/path/to/local-genesis.txt DEFAULT_POSTGRES=true python3 -m runners.alice --port 8030\n")),(0,o.kt)("p",null,"Note that Alice and Faber will each use 5 ports, e.g. using the parameter ",(0,o.kt)("inlineCode",{parentName:"p"},"... --port 8020")," actually uses ports 8020 through 8024. Feel free to use different ports if you want."),(0,o.kt)("p",null,"Everything running? See the ",(0,o.kt)("a",{parentName:"p",href:"#follow-the-script"},"Follow the Script")," section below for further instructions."),(0,o.kt)("p",null,"If the demo fails with an error that references the genesis file, a timeout connecting to the Indy Pool, or an Indy ",(0,o.kt)("inlineCode",{parentName:"p"},"307")," error, it's likely a problem with the genesis file handling. Things to check:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Review the instructions for running the ledger with ",(0,o.kt)("inlineCode",{parentName:"li"},"indy-sdk"),". Is it running properly?"),(0,o.kt)("li",{parentName:"ul"},"Is the ",(0,o.kt)("inlineCode",{parentName:"li"},"/path/to/local-genesis.txt")," file correct in your start commands?"),(0,o.kt)("li",{parentName:"ul"},"Look at the IP addresses in the genesis file you are using, and make sure that those IP addresses are accessible from the location you are running the Aries demo"),(0,o.kt)("li",{parentName:"ul"},"Check to make sure that all of the nodes of the ledger started. We've seen examples of only some of the nodes starting up, triggering an Indy ",(0,o.kt)("inlineCode",{parentName:"li"},"307")," error.")),(0,o.kt)("h3",{id:"follow-the-script"},"Follow The Script"),(0,o.kt)("p",null,"With both the Alice and Faber agents started, go to the Faber terminal window. The Faber agent has created and displayed an invitation. Copy this invitation and paste it at the Alice prompt. The agents will connect and then show a menu of options:"),(0,o.kt)("p",null,"Faber:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    (1) Issue Credential\n    (2) Send Proof Request\n    (3) Send Message\n    (4) Create New Invitation\n    (T) Toggle tracing on credential/proof exchange\n    (X) Exit?\n")),(0,o.kt)("p",null,"Alice:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    (3) Send Message\n    (4) Input New Invitation\n    (X) Exit?\n")),(0,o.kt)("h4",{id:"exchanging-messages"},"Exchanging Messages"),(0,o.kt)("p",null,'Feel free to use the "3" option to send messages back and forth between the agents. Fun, eh? Those are secure, end-to-end encrypted messages.'),(0,o.kt)("h4",{id:"issuing-and-proving-credentials"},"Issuing and Proving Credentials"),(0,o.kt)("p",null,'When ready to test the credentials exchange protocols, go to the Faber prompt, enter "1" to send a credential, and then "2" to request a proof.'),(0,o.kt)("p",null,"You don't need to do anything with Alice's agent - her agent is implemented to automatically receive credentials and respond to proof requests."),(0,o.kt)("p",null,'Note there is an option "2a" to initiate a connectionless proof - you can execute this option but it will only work end-to-end when ',(0,o.kt)("a",{parentName:"p",href:"/aries-acapy-docs/demo/AliceGetsAPhone"},"connecting to Faber from a mobile agent"),"."),(0,o.kt)("h2",{id:"additional-options-in-the-alicefaber-demo"},"Additional Options in the Alice/Faber demo"),(0,o.kt)("p",null,"You can enable support for various ACA-Py features by providing additional command-line arguements when starting up ",(0,o.kt)("inlineCode",{parentName:"p"},"alice")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"faber"),"."),(0,o.kt)("p",null,"Note that when the controller starts up the agent, it prints out the ACA-Py startup command with ",(0,o.kt)("em",{parentName:"p"},"all")," parameters - you can inspect this command to see what parameters are provided in each case. For more details on the parameters, just start ACA-Py with the ",(0,o.kt)("inlineCode",{parentName:"p"},"--help")," parameter, for example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./scripts/run_docker start --help\n")),(0,o.kt)("h3",{id:"revocation"},"Revocation"),(0,o.kt)("p",null,"To enable support for revoking credentials, run the ",(0,o.kt)("inlineCode",{parentName:"p"},"faber")," demo with the ",(0,o.kt)("inlineCode",{parentName:"p"},"--revocation")," option:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./run_demo faber --revocation\n")),(0,o.kt)("p",null,"Note that you don't specify this option with ",(0,o.kt)("inlineCode",{parentName:"p"},"alice")," because it's only applicable for the credential ",(0,o.kt)("inlineCode",{parentName:"p"},"issuer")," (who has to enable revocation when creating a credential definition, and explicitely revoke credentials as appropriate; alice doesn't have to do anything special when revocation is enabled)."),(0,o.kt)("p",null,"You need to run a revocation registry in order to support revocation - the details are described in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-cloudagent-python/blob/master/demo/AliceGetsAPhone.md#run-an-instance-of-indy-tails-server"},"Alice gets a Phone")," demo instructions."),(0,o.kt)("p",null,"Faber will setup support for revocation automatically, and you will see an extra option in faber's menu to revoke a credential:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    (1) Issue Credential\n    (2) Send Proof Request\n    (3) Send Message\n    (4) Create New Invitation\n    (5) Revoke Credential\n    (6) Publish Revocations\n    (T) Toggle tracing on credential/proof exchange\n    (X) Exit?\n")),(0,o.kt)("p",null,"When you issue a credential, make a note of the ",(0,o.kt)("inlineCode",{parentName:"p"},"Revocation registry ID")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Credential revocation ID"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Faber      | Revocation registry ID: WGmUNAdH2ZfeGvacFoMVVP:4:WGmUNAdH2ZfeGvacFoMVVP:3:CL:38:Faber.Agent.degree_schema:CL_ACCUM:15ca49ed-1250-4608-9e8f-c0d52d7260c3\nFaber      | Credential revocation ID: 1\n")),(0,o.kt)("p",null,"When you revoke a credential you will need to provide those values:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[1/2/3/4/5/6/T/X] 5\n\nEnter revocation registry ID: WGmUNAdH2ZfeGvacFoMVVP:4:WGmUNAdH2ZfeGvacFoMVVP:3:CL:38:Faber.Agent.degree_schema:CL_ACCUM:15ca49ed-1250-4608-9e8f-c0d52d7260c3\nEnter credential revocation ID: 1\nPublish now? [Y/N]: y\n")),(0,o.kt)("p",null,"Note that you need to Publish the revocation information to the ledger. Once you've revoked a credential any proof which uses this credential will fail to verify."),(0,o.kt)("h3",{id:"did-exchange"},"DID Exchange"),(0,o.kt)("p",null,"You can enable DID Exchange using the ",(0,o.kt)("inlineCode",{parentName:"p"},"--did-exchange")," parameter for the ",(0,o.kt)("inlineCode",{parentName:"p"},"alice")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"faber")," demos."),(0,o.kt)("p",null,"This will use the new DID Exchange protocol when establishing connections between the agents, rather than the older Connection protocol. There is no other affect on the operation of the agents."),(0,o.kt)("p",null,"Note that you can't (currently) use the DID Exchange protocol to connect with any of the available mobile agents."),(0,o.kt)("h3",{id:"endorser"},"Endorser"),(0,o.kt)("p",null,"This is described in ",(0,o.kt)("a",{parentName:"p",href:"/aries-acapy-docs/demo/Endorser"},"Endorser.md")),(0,o.kt)("h3",{id:"run-indy-sdk-backend"},"Run Indy-SDK Backend"),(0,o.kt)("p",null,"This runs using the indy-sdk libraries instead of askar:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./run_demo faber --wallet-type indy\n")),(0,o.kt)("h3",{id:"mediation"},"Mediation"),(0,o.kt)("p",null,"To enable mediation, run the ",(0,o.kt)("inlineCode",{parentName:"p"},"alice")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"faber")," demo with the ",(0,o.kt)("inlineCode",{parentName:"p"},"--mediation")," option:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./run_demo faber --mediation\n")),(0,o.kt)("p",null,'This will start up a second "mediator" agent and automatically set the alice/faber connection to use the mediator.'),(0,o.kt)("h3",{id:"multi-tenancy"},"Multi-tenancy"),(0,o.kt)("p",null,"To enable support for multi-tenancy, run the ",(0,o.kt)("inlineCode",{parentName:"p"},"alice")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"faber")," demo with the ",(0,o.kt)("inlineCode",{parentName:"p"},"--multitenant")," option:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./run_demo faber --multitenant\n")),(0,o.kt)("p",null,"(This option can be used with both (or either) ",(0,o.kt)("inlineCode",{parentName:"p"},"alice")," and/or ",(0,o.kt)("inlineCode",{parentName:"p"},"faber"),".)"),(0,o.kt)("h3",{id:"multi-ledger"},"Multi-ledger"),(0,o.kt)("p",null,"To enable multiple ledger mode, run the ",(0,o.kt)("inlineCode",{parentName:"p"},"alice")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"faber")," demo with the ",(0,o.kt)("inlineCode",{parentName:"p"},"--multi-ledger")," option:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./run_demo faber --multi-ledger\n")),(0,o.kt)("p",null,"The configuration file for setting up multiple ledgers (for the demo) can be found at ",(0,o.kt)("inlineCode",{parentName:"p"},"./demo/multiple_ledger_config.yml"),"."),(0,o.kt)("p",null,'You will see an additional menu option to create new sub-wallets (or they can be considered to be "virtual agents").'),(0,o.kt)("p",null,"Faber:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    (1) Issue Credential\n    (2) Send Proof Request\n    (3) Send Message\n    (4) Create New Invitation\n    (W) Create and/or Enable Wallet\n    (T) Toggle tracing on credential/proof exchange\n    (X) Exit?\n")),(0,o.kt)("p",null,"Alice:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    (3) Send Message\n    (4) Input New Invitation\n    (W) Create and/or Enable Wallet\n    (X) Exit?\n")),(0,o.kt)("p",null,'When you create a new wallet, you just need to provide the wallet name. (If you provide the name of an existing wallet then the controller will "activate" that wallet and make it the current wallet.)'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[1/2/3/4/W/T/X] w\n\nEnter wallet name: new_wallet_12\n\nFaber      | Register or switch to wallet new_wallet_12\nFaber      | Created new profile\nFaber      | Profile backend: indy\nFaber      | Profile name: new_wallet_12\nFaber      | No public DID\n... etc\n")),(0,o.kt)("p",null,"Note that ",(0,o.kt)("inlineCode",{parentName:"p"},"faber")," will create a public DID for this wallet, and will create a schema and credential definition."),(0,o.kt)("p",null,"Once you have created a new wallet, you must establish a connection between ",(0,o.kt)("inlineCode",{parentName:"p"},"alice")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"faber"),' (remember that this is a new "virtual agent" and doesn\'t know anything about connections established for other "agents").'),(0,o.kt)("p",null,"In faber, create a new invitation:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[1/2/3/4/W/T/X] 4\n\n(... creates a new invitation ...)\n")),(0,o.kt)("p",null,"In alice, accept the invitation:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[1/2/3/4/W/T/X] 4\n\n(... enter the new invitation string ...)\n")),(0,o.kt)("p",null,"You can inspect the additional multi-tenancy admin API's (i.e. the \"agency API\" by opening either agent's swagger page in your browser:"),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Show me a screenshot - multi-tenancy via admin API"),(0,o.kt)("img",{src:"./collateral/multitenancy-admin-api.png",alt:"Multi-tenancy via Admin API"})),(0,o.kt)("p",null,"Note that with multi-tenancy enabled:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'The "base" wallet will have access to this new "agency API" - the agent\'s admin key, if enabled, must be provided in a header'),(0,o.kt)("li",{parentName:"ul"},'"Base wallet" API calls are handled ',(0,o.kt)("a",{parentName:"li",href:"https://github.com/hyperledger/aries-cloudagent-python/blob/244194e68330835e5e2e53cc6c2993899d2437fb/demo/runners/support/agent.py#L606"},"here")),(0,o.kt)("li",{parentName:"ul"},'The "sub-wallets" will have access to the "normal" ACA-Py admin API - to identify the sub-wallet, a JWT token must be provided, this token is created upon creation of the new wallet (see: ',(0,o.kt)("a",{parentName:"li",href:"https://github.com/hyperledger/aries-cloudagent-python/blob/master/demo/runners/support/agent.py#L378"},"this code here"),")"),(0,o.kt)("li",{parentName:"ul"},'"Sub-wallet" API calls are handled ',(0,o.kt)("a",{parentName:"li",href:"https://github.com/hyperledger/aries-cloudagent-python/blob/244194e68330835e5e2e53cc6c2993899d2437fb/demo/runners/support/agent.py#L632"},"here"))),(0,o.kt)("p",null,"Documentation on ACA-Py's multi-tenancy support can be found ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-cloudagent-python/blob/master/Multitenancy.md"},"here"),"."),(0,o.kt)("h3",{id:"multi-tenancy-with-mediation"},"Multi-tenancy ",(0,o.kt)("em",{parentName:"h3"},"with Mediation"),"!!!"),(0,o.kt)("p",null,"There are two options for configuring mediation with multi-tenancy, documented ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-cloudagent-python/blob/master/Multitenancy.md#mediation"},"here"),"."),(0,o.kt)("p",null,"This demo implements option #2 - each sub-wallet is configured with a separate connection to the mediator."),(0,o.kt)("p",null,"Run the demo (Alice or Faber) specifying ",(0,o.kt)("em",{parentName:"p"},"both")," options:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./run_demo faber --multitenant --mediation\n")),(0,o.kt)("p",null,"This works exactly as the ",(0,o.kt)("em",{parentName:"p"},"vanilla")," multi-tenancy, except that all connections are mediated."),(0,o.kt)("h2",{id:"learning-about-the-alicefaber-code"},"Learning about the Alice/Faber code"),(0,o.kt)("p",null,"These Alice and Faber scripts (in the ",(0,o.kt)("inlineCode",{parentName:"p"},"demo/runners")," folder) implement the controller and run the agent as a sub-process (see the documentation for ",(0,o.kt)("inlineCode",{parentName:"p"},"aca-py"),"). The controller publishes a REST service to receive web hook callbacks from their agent. Note that this architecture, running the agent as a sub-process, is a variation on the documented architecture of running the controller and agent as separate processes/containers."),(0,o.kt)("p",null,"The controllers for this demo can be found in the ",(0,o.kt)("a",{parentName:"p",href:"runners/alice.py"},"alice.py")," and ",(0,o.kt)("a",{parentName:"p",href:"runners/faber.py"},"faber.py")," files. Alice and Faber are instances of the agent class found in ",(0,o.kt)("a",{parentName:"p",href:"runners/support/agent.py"},"agent.py"),"."),(0,o.kt)("h2",{id:"openapi-swagger-demo"},"OpenAPI (Swagger) Demo"),(0,o.kt)("p",null,"Developing an ACA-Py controller is much like developing a web app that uses a REST API. As you develop, you will want an easy way to test out the behaviour of the API. That's where the industry-standard OpenAPI (aka Swagger) UI comes in. ACA-Py (optionally) exposes an OpenAPI UI in ACA-Py that you can use to learn the ins and outs of the API. This ",(0,o.kt)("a",{parentName:"p",href:"/aries-acapy-docs/demo/AriesOpenAPIDemo"},"Aries OpenAPI demo")," shows how you can use the OpenAPI UI with an ACA-Py agent by walking through the connectiing, issuing a credential, and presenting a proof sequence."),(0,o.kt)("h2",{id:"performance-demo"},"Performance Demo"),(0,o.kt)("p",null,"Another example in the ",(0,o.kt)("inlineCode",{parentName:"p"},"demo/runners")," folder is ",(0,o.kt)("a",{parentName:"p",href:"runners/performance.py"},"performance.py"),", that is used to test out the performance of interacting agents. The script starts up agents for Alice and Faber, initializes them, and then runs through an interaction some number of times. In this case, Faber issues a credential to Alice 300 times."),(0,o.kt)("p",null,"To run the demo, make sure that you shut down any running Alice/Faber agents. Then, follow the same steps to start the Alice/Faber demo, but:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"When starting the first agent, replace the agent name (e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"faber"),") with ",(0,o.kt)("inlineCode",{parentName:"li"},"performance"),"."),(0,o.kt)("li",{parentName:"ul"},"Don't start the second agent (",(0,o.kt)("inlineCode",{parentName:"li"},"alice"),") at all.")),(0,o.kt)("p",null,"The script starts both agents, runs the performance test, spits out performance results and shuts down the agents. Note that this is just one demonstration of how performance metrics tracking can be done with ACA-Py."),(0,o.kt)("p",null,"A second version of the performance test can be run by adding the parameter ",(0,o.kt)("inlineCode",{parentName:"p"},"--routing")," to the invocation above. The parameter triggers the example to run with Alice using a routing agent such that all messages pass through the routing agent between Alice and Faber. This is a good, simple example of how routing can be implemented with DIDComm agents."),(0,o.kt)("p",null,"You can also run the demo against a postgres database using the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./run_demo performance --arg-file demo/postgres-indy-args.yml\n")),(0,o.kt)("p",null,"(Obvs you need to be running a postgres database - the command to start postgres is in the yml file provided above.)"),(0,o.kt)("p",null,"You can tweak the number of credentials issued using the ",(0,o.kt)("inlineCode",{parentName:"p"},"--count")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"--batch")," parameters, and you can run against an Askar database using the ",(0,o.kt)("inlineCode",{parentName:"p"},"--wallet-type askar")," option (or run using indy-sdk using ",(0,o.kt)("inlineCode",{parentName:"p"},"--wallet-type indy"),")."),(0,o.kt)("p",null,"An example full set of options is:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./run_demo performance --arg-file demo/postgres-indy-args.yml -c 10000 -b 10 --wallet-type askar\n")),(0,o.kt)("p",null,"Or:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./run_demo performance --arg-file demo/postgres-indy-args.yml -c 10000 -b 10 --wallet-type indy\n")),(0,o.kt)("h2",{id:"coding-challenge-adding-acme"},"Coding Challenge: Adding ACME"),(0,o.kt)("p",null,"Now that you have a solid foundation in using ACA-Py, time for a coding challenge. In this challenge, we extend the Alice-Faber command line demo by adding in ACME Corp, a place where Alice wants to work. The demo adds:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"ACME inviting Alice to connect"),(0,o.kt)("li",{parentName:"ul"},"ACME requesting a proof of her College degree"),(0,o.kt)("li",{parentName:"ul"},"ACME issuing Alice a credential after she is hired.")),(0,o.kt)("p",null,"The framework for the code is in the ",(0,o.kt)("a",{parentName:"p",href:"runners/acme.py"},"acme.py")," file, but the code is incomplete. Using the knowledge you gained from running demo and viewing the alice.py and faber.py code, fill in the blanks for the code. When you are ready to test your work:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Use the instructions above to start the Alice/Faber demo (above)."),(0,o.kt)("li",{parentName:"ul"},'Start another terminal session and run the same commands as for "Alice", but replace "alice" with "acme".')),(0,o.kt)("p",null,"All done? Checkout how we added the missing code segments ",(0,o.kt)("a",{parentName:"p",href:"/aries-acapy-docs/demo/AcmeDemoWorkshop"},"here"),"."))}h.isMDXComponent=!0}}]);