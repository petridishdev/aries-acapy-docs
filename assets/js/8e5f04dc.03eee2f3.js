"use strict";(self.webpackChunkaries_cloud_agent_python_documentation=self.webpackChunkaries_cloud_agent_python_documentation||[]).push([[2227],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>h});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=i.createContext({}),d=function(e){var t=i.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=d(e.components);return i.createElement(c.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=d(n),m=r,h=p["".concat(c,".").concat(m)]||p[m]||u[m]||a;return n?i.createElement(h,o(o({ref:t},s),{},{components:n})):i.createElement(h,o({ref:t},s))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[p]="string"==typeof e?e:r,o[1]=l;for(var d=2;d<a;d++)o[d]=n[d];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1785:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var i=n(7462),r=(n(7294),n(3905));const a={},o="Credential Revocation",l={unversionedId:"developer/CredentialRevocation",id:"developer/CredentialRevocation",title:"Credential Revocation",description:"These are the ACA-py steps and APIs involved to support credential revocation.",source:"@site/docs/developer/CredentialRevocation.md",sourceDirName:"developer",slug:"/developer/CredentialRevocation",permalink:"/aries-acapy-docs/developer/CredentialRevocation",draft:!1,editUrl:"https://github.com/hyperledger/aries-acapy-docs/tree/main/docs/docusaurus/docs/developer/CredentialRevocation.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Connecting to an Indy Network",permalink:"/aries-acapy-docs/developer/ConnectIndyNetwork"},next:{title:"Deeper Dive: DIDComm Messaging",permalink:"/aries-acapy-docs/developer/DIDcommMsgs"}},c={},d=[{value:"Revocation Notification",id:"revocation-notification",level:2},{value:"Issuer Role",id:"issuer-role",level:3},{value:"Holder Role",id:"holder-role",level:3},{value:"Manually Creating Revocation Registries",id:"manually-creating-revocation-registries",level:2}],s={toc:d},p="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,i.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"credential-revocation"},"Credential Revocation"),(0,r.kt)("p",null,"These are the ACA-py steps and APIs involved to support credential revocation."),(0,r.kt)("p",null,"Run ACA-Py with tails server support enabled. You will need to have the URL of an running instance of ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/bcgov/indy-tails-server"},"https://github.com/bcgov/indy-tails-server"),"."),(0,r.kt)("p",null,"Include the command line parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"--tails-server-base-url <indy-tails-server url>")),(0,r.kt)("ol",{start:0},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Publish credential definition"),(0,r.kt)("p",{parentName:"li"},"Credential definition is created. All required revocation collateral is also created\nand managed including revocation registry definition, entry, and tails file."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'POST /credential-definitions\n{\n  "schema_id": schema_id,\n  "support_revocation": true,\n  # Only needed if support_revocation is true. Defaults to 100\n  "revocation_registry_size": size_int,\n  "tag": cred_def_tag # Optional\n\n}\nResponse:\n{\n  "credential_definition_id": "credential_definition_id"\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Issue credential"),(0,r.kt)("p",{parentName:"li"},"This endpoint manages revocation data. If new revocation registry data is required,\nit is automatically managed in the background."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'POST /issue-credential/send-offer\n{\n    "cred_def_id": credential_definition_id,\n    "revoc_reg_id": revocation_registry_id\n    "auto_remove": False, # We need the credential exchange record when revoking\n    ...\n}\nResponse\n{\n    "credential_exchange_id": credential_exchange_id\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Revoking credential"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},'POST /revocation/revoke\n{\n    "rev_reg_id": <revocation_registry_id>\n    "cred_rev_id": <credential_revocation_id>,\n    "publish": <true|false>\n}\n')),(0,r.kt)("p",{parentName:"li"},"If publish=false, you must use ",(0,r.kt)("inlineCode",{parentName:"p"},"\u200b/issue-credential\u200b/publish-revocations")," to publish\npending revocations in batches. Revocation are not written to ledger until this is called.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"When asking for proof, specify the timespan when the credential is NOT revoked"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},' POST /present-proof/send-request\n {\n   "connection_id": ...,\n   "proof_request": {\n     "requested_attributes": [\n       {\n         "name": ...\n         "restrictions": ...,\n         ...\n         "non_revoked": # Optional, override the global one when specified\n         {\n           "from": <seconds from Unix Epoch> # Optional, default is 0\n           "to": <seconds from Unix Epoch>\n         }\n       },\n       ...\n     ],\n     "requested_predicates": [\n       {\n         "name": ...\n         ...\n         "non_revoked": # Optional, override the global one when specified\n         {\n           "from": <seconds from Unix Epoch> # Optional, default is 0\n           "to": <seconds from Unix Epoch>\n         }\n       },\n       ...\n     ],\n     "non_revoked": # Optional, only check revocation if specified\n     {\n       "from": <seconds from Unix Epoch> # Optional, default is 0\n       "to": <seconds from Unix Epoch>\n     }\n   }\n }\n')))),(0,r.kt)("h2",{id:"revocation-notification"},"Revocation Notification"),(0,r.kt)("p",null,"ACA-Py supports ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hyperledger/aries-rfcs/blob/main/features/0183-revocation-notification/README.md"},"Revocation Notification v1.0"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note:")," The optional ",(0,r.kt)("inlineCode",{parentName:"p"},"~please_ack")," is not currently supported.")),(0,r.kt)("h3",{id:"issuer-role"},"Issuer Role"),(0,r.kt)("p",null,"To notify connections to which credentials have been issued, during step 2\nabove, include the following attributes in the request body:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"notify")," - A boolean value indicating whether or not a notification should be\nsent. If the argument ",(0,r.kt)("inlineCode",{parentName:"li"},"--notify-revocation")," is used on startup, this value\ndefaults to ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),". Otherwise, it will default to ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),". This value\noverrides the ",(0,r.kt)("inlineCode",{parentName:"li"},"--notify-revocation")," flag; the value of ",(0,r.kt)("inlineCode",{parentName:"li"},"notify")," always takes\nprecedence."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"connection_id")," - Connection ID for the connection of the credential holder.\nThis is required when ",(0,r.kt)("inlineCode",{parentName:"li"},"notify")," is ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"thread_id")," - Message Thread ID of the credential exchange message that\nresulted in the credential now being revoked. This is required when ",(0,r.kt)("inlineCode",{parentName:"li"},"notify"),"\nis ",(0,r.kt)("inlineCode",{parentName:"li"},"true")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"comment")," - An optional comment presented to the credential holder as part of\nthe revocation notification. This field might contain the reason for\nrevocation or some other human readable information about the revocation.")),(0,r.kt)("p",null,"Your request might look something like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'POST /revocation/revoke\n{\n    "rev_reg_id": <revocation_registry_id>\n    "cred_rev_id": <credential_revocation_id>,\n    "publish": <true|false>,\n    "notify": true,\n    "connection_id": <connection id>,\n    "thread_id": <thread id>,\n    "comment": "optional comment"\n}\n')),(0,r.kt)("h3",{id:"holder-role"},"Holder Role"),(0,r.kt)("p",null,"On receipt of a revocation notification, an event with topic\n",(0,r.kt)("inlineCode",{parentName:"p"},"acapy::revocation-notification::received")," and payload containing the thread ID\nand comment is emitted on the event bus. This can be handled in plugins to\nfurther customize notification handling."),(0,r.kt)("p",null,"If the argument ",(0,r.kt)("inlineCode",{parentName:"p"},"--monitor-revocation-notification")," is used on startup, a\nwebhook with the topic ",(0,r.kt)("inlineCode",{parentName:"p"},"revocation-notification")," and a payload containing the\nthread ID and comment is emitted to registered webhook urls."),(0,r.kt)("h2",{id:"manually-creating-revocation-registries"},"Manually Creating Revocation Registries"),(0,r.kt)("p",null,"The process for creating revocation registries is completely automated - when you create a Credential Definition with revocation enabled, a revocation registry is automatically created (in fact 2 registries are created), and when a registry fills up, a new one is automatically created."),(0,r.kt)("p",null,"However the Aca-Py admin api supports endpoints to explicitely create a new revocation registry, if you desire."),(0,r.kt)("p",null,"There are several endpoints that must be called, and they must be called in this order:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create revoc registry ",(0,r.kt)("inlineCode",{parentName:"p"},"POST /revocation/create-registry")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"you need to provide the credential definition id and the size of the registry"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Fix the tails file URI ",(0,r.kt)("inlineCode",{parentName:"p"},"PATCH /revocation/registry/{rev_reg_id}")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"here you need to provide the full URI that will be written to the ledger, for example:")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "tails_public_uri": "http://host.docker.internal:6543/VDKEEMMSRTEqK4m7iiq5ZL:4:VDKEEMMSRTEqK4m7iiq5ZL:3:CL:8:faber.agent.degree_schema:CL_ACCUM:3cb5c439-928c-483c-a9a8-629c307e6b2d"\n}\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Post the revoc def to the ledger ",(0,r.kt)("inlineCode",{parentName:"p"},"POST /revocation/registry/{rev_reg_id}/definition")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"if you are an author (i.e. have a DID with restricted ledger write access) then this transaction may need to go through an endorser"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Write the tails file ",(0,r.kt)("inlineCode",{parentName:"p"},"PUT /revocation/registry/{rev_reg_id}/tails-file")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"the tails server will check that the registry definition is already written to the ledger")))))}u.isMDXComponent=!0}}]);