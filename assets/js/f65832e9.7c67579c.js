"use strict";(self.webpackChunkaries_cloud_agent_python_documentation=self.webpackChunkaries_cloud_agent_python_documentation||[]).push([[729],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=a(e,["components","mdxType","originalType","parentName"]),c=p(n),m=o,h=c["".concat(s,".").concat(m)]||c[m]||u[m]||i;return n?r.createElement(h,l(l({ref:t},d),{},{components:n})):r.createElement(h,l({ref:t},d))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,l=new Array(i);l[0]=m;var a={};for(var s in t)hasOwnProperty.call(t,s)&&(a[s]=t[s]);a.originalType=e,a[c]="string"==typeof e?e:o,l[1]=a;for(var p=2;p<i;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1882:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>p});var r=n(7462),o=(n(7294),n(3905));const i={},l="DID Resolution in ACA-Py",a={unversionedId:"docs/DIDResolution",id:"docs/DIDResolution",title:"DID Resolution in ACA-Py",description:'Decentralized Identifiers, or DIDs, are URIs that point to documents that describe cryptographic primitives and protocols used in decentralized identity management. DIDs include methods that describe where and how documents can be retrieved. DID resolution is the process of "resolving" a DID Document from a DID as dictated by the DID method.',source:"@site/docs/docs/DIDResolution.md",sourceDirName:"docs",slug:"/docs/DIDResolution",permalink:"/aries-acapy-docs/docs/DIDResolution",draft:!1,editUrl:"https://github.com/hyperledger/aries-acapy-docs/tree/main/docs/docusaurus/docs/docs/DIDResolution.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"DID methods in ACA-Py",permalink:"/aries-acapy-docs/docs/DIDMethods"},next:{title:"Databases",permalink:"/aries-acapy-docs/docs/Databases"}},s={},p=[{value:"<code>DIDResolver</code>",id:"didresolver",level:2},{value:"Example usage:",id:"example-usage",level:4},{value:"Method Resolver Selection",id:"method-resolver-selection",level:2},{value:"Resolver Plugins",id:"resolver-plugins",level:2},{value:"Writing a resolver plugin",id:"writing-a-resolver-plugin",level:3},{value:"<code>__init __.py</code>",id:"__init-__py",level:4},{value:"<code>example_resolver.py</code>",id:"example_resolverpy",level:4},{value:"Errors",id:"errors",level:4},{value:"Using Resolver Plugins",id:"using-resolver-plugins",level:3},{value:"Directory of Resolver Plugins",id:"directory-of-resolver-plugins",level:3},{value:"References",id:"references",level:2}],d={toc:p},c="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(c,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"did-resolution-in-aca-py"},"DID Resolution in ACA-Py"),(0,o.kt)("p",null,'Decentralized Identifiers, or DIDs, are URIs that point to documents that describe cryptographic primitives and protocols used in decentralized identity management. DIDs include methods that describe where and how documents can be retrieved. DID resolution is the process of "resolving" a DID Document from a DID as dictated by the DID method.'),(0,o.kt)("p",null,"A DID Resolver is a piece of software that implements the methods for resolving a document from a DID."),(0,o.kt)("p",null,"For example, given the DID ",(0,o.kt)("inlineCode",{parentName:"p"},"did:example:1234abcd"),", a DID Resolver that supports ",(0,o.kt)("inlineCode",{parentName:"p"},"did:example")," might return:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json="},'{\n    "@context": "https://www.w3.org/ns/did/v1",\n    "id": "did:example:1234abcd",\n    "verificationMethod": [{\n        "id": "did:example:1234abcd#keys-1",\n        "type": "Ed25519VerificationKey2018",\n        "controller": "did:example:1234abcd",\n        "publicKeyBase58": "H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV"\n    }],\n    "service": [{\n        "id": "did:example:1234abcd#did-communication",\n        "type": "did-communication",\n        "serviceEndpoint": "https://agent.example.com/8377464"\n    }]\n}\n')),(0,o.kt)("p",null,"For more details on DIDs and DID Resolution, see the ",(0,o.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/did-core/"},"W3C DID Specification"),"."),(0,o.kt)("p",null,"In practice, DIDs and DID Documents are used for a variety of purposes but especially to help establish connections between Agents and verify credentials."),(0,o.kt)("h2",{id:"didresolver"},(0,o.kt)("inlineCode",{parentName:"h2"},"DIDResolver")),(0,o.kt)("p",null,"In ACA-Py, the ",(0,o.kt)("inlineCode",{parentName:"p"},"DIDResolver")," provides the interface to resolve DIDs using registered method resolvers. Method resolver registration happens on startup in a ",(0,o.kt)("inlineCode",{parentName:"p"},"did_resolvers")," list. This registry enables additional resolvers to be loaded via plugin."),(0,o.kt)("h4",{id:"example-usage"},"Example usage:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python="},'class ExampleMessageHandler:\n    async def handle(context: RequestContext, responder: BaseResponder):\n    """Handle example message."""\n    resolver = await context.inject(DIDResolver)\n\n    doc: dict = await resolver.resolve("did:example:123")\n    assert doc["id"] == "did:example:123"\n    \n    verification_method = await resolver.dereference("did:example:123#keys-1")\n    \n    # ...\n')),(0,o.kt)("h2",{id:"method-resolver-selection"},"Method Resolver Selection"),(0,o.kt)("p",null,"On ",(0,o.kt)("inlineCode",{parentName:"p"},"DIDResolver.resolve")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"DIDResolver.dereference"),", the resolver interface will select the most appropriate method resolver to handle the given DID. In this selection process, method resolvers are distinguished from each other by:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'Type. The resolver\'s type falls into one of two categories: native or non-native. A "native" resolver will perform all resolution steps directly. A "non-native" resolver delegates all or part of resolution to another service or entity.'),(0,o.kt)("li",{parentName:"ul"},"Self-reported supported DIDs. Each method resolver implements a ",(0,o.kt)("inlineCode",{parentName:"li"},"supports")," method or a ",(0,o.kt)("inlineCode",{parentName:"li"},"supported_did_regex")," method. These methods are used to determine whether the given DID can be handled by the method resolver.")),(0,o.kt)("p",null,"The selection algorithm roughly follows the following steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Filter out all resolvers where ",(0,o.kt)("inlineCode",{parentName:"li"},"resolver.supports(did)")," returns ",(0,o.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,o.kt)("li",{parentName:"ol"},"Partition remaining resolvers by type with all native resolvers followed by non-native resolvers (registration order preserved within partitions)."),(0,o.kt)("li",{parentName:"ol"},"For each resolver in the resulting list, attempt to resolve the DID and return the first successful result.")),(0,o.kt)("h2",{id:"resolver-plugins"},"Resolver Plugins"),(0,o.kt)("p",null,"Extending ACA-Py with additional Method Resolvers should be relatively simple. Supposing that you want to resolve DIDs for the ",(0,o.kt)("inlineCode",{parentName:"p"},"did:cool")," method, this should be as simple as installing a method resolver into your python environment and loading the resolver on startup. If no method resolver exists yet for ",(0,o.kt)("inlineCode",{parentName:"p"},"did:cool"),", writing your own should require minimal overhead."),(0,o.kt)("h3",{id:"writing-a-resolver-plugin"},"Writing a resolver plugin"),(0,o.kt)("p",null,"Method resolver plugins are composed of two primary pieces: plugin injection and resolution logic. The resolution logic dictates how a DID becomes a DID Document, following the given DID Method Specification. This logic is implemented using the ",(0,o.kt)("inlineCode",{parentName:"p"},"BaseDIDResolver")," class as the base. ",(0,o.kt)("inlineCode",{parentName:"p"},"BaseDIDResolver")," is an abstract base class that defines the interface that the core ",(0,o.kt)("inlineCode",{parentName:"p"},"DIDResolver")," expects for Method resolvers."),(0,o.kt)("p",null,"The following is an example method resolver implementation. In this example, we have 2 files, one for each piece (injection and resolution). The ",(0,o.kt)("inlineCode",{parentName:"p"},"__init__.py")," will be in charge of injecting the plugin, and ",(0,o.kt)("inlineCode",{parentName:"p"},"example_resolver.py")," will have the logic implementation to resolve for a fabricated ",(0,o.kt)("inlineCode",{parentName:"p"},"did:example")," method."),(0,o.kt)("h4",{id:"__init-__py"},(0,o.kt)("inlineCode",{parentName:"h4"},"__init __.py")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python="},'from aries_cloudagent.config.injection_context import InjectionContext\nfrom ..resolver.did_resolver import DIDResolver\n\nfrom .example_resolver import ExampleResolver\n\n\nasync def setup(context: InjectionContext):\n    """Setup the plugin."""\n    registry = context.inject(DIDResolver)\n    resolver = ExampleResolver()\n    await resolver.setup(context)\n    registry.append(resolver)\n')),(0,o.kt)("h4",{id:"example_resolverpy"},(0,o.kt)("inlineCode",{parentName:"h4"},"example_resolver.py")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python="},'import re\nfrom typing import Pattern\nfrom aries_cloudagent.resolver.base import BaseDIDResolver, ResolverType\n\nclass ExampleResolver(BaseDIDResolver):\n    """ExampleResolver class."""\n\n    def __init__(self):\n        super().__init__(ResolverType.NATIVE)\n        # Alternatively, ResolverType.NON_NATIVE\n        self._supported_did_regex = re.compile("^did:example:.*$")\n\n    @property\n    def supported_did_regex(self) -> Pattern:\n        """Return compiled regex matching supported DIDs."""\n        return self._supported_did_regex\n\n    async def setup(self, context):\n        """Setup the example resolver (none required)."""\n\n    async def _resolve(self, profile: Profile, did: str) -> dict:\n        """Resolve example DIDs."""\n        if did != "did:example:1234abcd":\n            raise DIDNotFound(\n                "We only actually resolve did:example:1234abcd. Sorry!"\n            )\n\n        return {\n            "@context": "https://www.w3.org/ns/did/v1",\n            "id": "did:example:1234abcd",\n            "verificationMethod": [{\n                "id": "did:example:1234abcd#keys-1",\n                "type": "Ed25519VerificationKey2018",\n                "controller": "did:example:1234abcd",\n                "publicKeyBase58": "H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV"\n            }],\n            "service": [{\n                "id": "did:example:1234abcd#did-communication",\n                "type": "did-communication",\n                "serviceEndpoint": "https://agent.example.com/"\n            }]\n        }\n')),(0,o.kt)("h4",{id:"errors"},"Errors"),(0,o.kt)("p",null,"There are 3 different errors associated with resolution in ACA-Py that could be used for development purposes."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"ResolverError",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Base class for resolver exceptions."))),(0,o.kt)("li",{parentName:"ul"},"DIDNotFound",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Raised when DID is not found using DID method specific algorithm."))),(0,o.kt)("li",{parentName:"ul"},"DIDMethodNotSupported",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Raised when no resolver is registered for a given did method.")))),(0,o.kt)("h3",{id:"using-resolver-plugins"},"Using Resolver Plugins"),(0,o.kt)("p",null,"In this section, the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/dbluhm/acapy-resolver-github"},"Github Resolver Plugin found here")," will be used as an an example plugin to work with. This resolver resolves ",(0,o.kt)("inlineCode",{parentName:"p"},"did:github")," DIDs. "),(0,o.kt)("p",null,"The resolution algorithm is simple: for the github DID ",(0,o.kt)("inlineCode",{parentName:"p"},"did:github:dbluhm"),", the method specific identifier ",(0,o.kt)("inlineCode",{parentName:"p"},"dbluhm")," (a GitHub username) is used to lookup a ",(0,o.kt)("inlineCode",{parentName:"p"},"index.jsonld")," file in the ",(0,o.kt)("inlineCode",{parentName:"p"},"ghdid")," repository in that GitHub users profile. See ",(0,o.kt)("a",{parentName:"p",href:"http://docs.github-did.com/did-method-spec/"},"GitHub DID Method Specification")," for more details."),(0,o.kt)("p",null,"To use this plugin, first install it into your project's python environment:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ pip install git+https://github.com/dbluhm/acapy-resolver-github\n")),(0,o.kt)("p",null,"Then, invoke ACA-Py as you normally do with the addition of:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ aca-py start \\\n    --plugin acapy_resolver_github \\\n    # ... the remainder of your startup arguments\n")),(0,o.kt)("p",null,"Or add the following to your configuration file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml="},"plugin:\n  - acapy_resolver_github\n")),(0,o.kt)("p",null,"The following is a fully functional Dockerfile encapsulating this setup:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dockerfile="},'# TODO replace the following two lines with ACA-Py 0.7.0 when released\nFROM bcgovimages/von-image:py36-1.16-0\nRUN pip3 install git+https://github.com/hyperledger/aries-cloudagent-python@2ff1ddba897d26a7deb761924018145162cc867c\nRUN pip3 install git+https://github.com/dbluhm/acapy-resolver-github\n\nCMD ["aca-py", "start", "-it", "http", "0.0.0.0", "3000", "-ot", "http", "-e", "http://localhost:3000", "--admin", "0.0.0.0", "3001", "--admin-insecure-mode", "--no-ledger", "--plugin", "acapy_resolver_github"]\n')),(0,o.kt)("p",null,"To use the above dockerfile:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ docker build -t resolver-example .\n$ docker run --rm -it -p 3000:3000 -p 3001:3001 resolver-example\n")),(0,o.kt)("h3",{id:"directory-of-resolver-plugins"},"Directory of Resolver Plugins"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/dbluhm/acapy-resolver-github"},"Github Resolver")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/sicpa-dlab/acapy-resolver-universal"},"Universal Resolver")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/sicpa-dlab/acapy-resolver-didcomm"},"DIDComm Resolver"))),(0,o.kt)("h2",{id:"references"},"References"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/did-core/"},"https://www.w3.org/TR/did-core/"),"\n",(0,o.kt)("a",{parentName:"p",href:"https://w3c-ccg.github.io/did-resolution/"},"https://w3c-ccg.github.io/did-resolution/")))}u.isMDXComponent=!0}}]);