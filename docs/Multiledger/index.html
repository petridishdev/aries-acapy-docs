<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-docs/Multiledger">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Multi-ledger in ACA-Py | Aries Cloud Agent Python (ACA-Py)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hyperledger.github.io/aries-acapy-docs/docs/Multiledger"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Multi-ledger in ACA-Py | Aries Cloud Agent Python (ACA-Py)"><meta data-rh="true" name="description" content="Ability to use multiple Indy ledgers (both IndySdk and IndyVdr) for resolving a DID by the ACA-Py agent. For read requests, checking of multiple ledgers in parallel is done dynamically according to logic detailed in Read Requests Ledger Selection. For write requests, dynamic allocation of writeledger is not supported. Write ledger can be assigned using iswrite in the configuration or using any of the --genesis-url, --genesis-file, and --genesis-transactions startup (ACA-Py) arguments. If no write ledger is assigned then a ConfigError is raised."><meta data-rh="true" property="og:description" content="Ability to use multiple Indy ledgers (both IndySdk and IndyVdr) for resolving a DID by the ACA-Py agent. For read requests, checking of multiple ledgers in parallel is done dynamically according to logic detailed in Read Requests Ledger Selection. For write requests, dynamic allocation of writeledger is not supported. Write ledger can be assigned using iswrite in the configuration or using any of the --genesis-url, --genesis-file, and --genesis-transactions startup (ACA-Py) arguments. If no write ledger is assigned then a ConfigError is raised."><link data-rh="true" rel="icon" href="/aries-acapy-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hyperledger.github.io/aries-acapy-docs/docs/Multiledger"><link data-rh="true" rel="alternate" href="https://hyperledger.github.io/aries-acapy-docs/docs/Multiledger" hreflang="en"><link data-rh="true" rel="alternate" href="https://hyperledger.github.io/aries-acapy-docs/docs/Multiledger" hreflang="x-default"><link rel="stylesheet" href="/aries-acapy-docs/assets/css/styles.4ae0b40d.css">
<link rel="preload" href="/aries-acapy-docs/assets/js/runtime~main.55efbebf.js" as="script">
<link rel="preload" href="/aries-acapy-docs/assets/js/main.f211ac65.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/aries-acapy-docs/"><div class="navbar__logo"><img src="/aries-acapy-docs/img/aries-logo.png" alt="ACA-Py" class="themedImage_ToTc themedImage--light_HNdA"><img src="/aries-acapy-docs/img/aries-logo.png" alt="ACA-Py" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Aries Cloud Agent Python</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/aries-acapy-docs/docs/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/aries-acapy-docs/code/">Code</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/aries-acapy-docs/demo/">Demo</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hyperledger/aries-acapy-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/aries-acapy-docs/admin/CHANGELOG">Admin</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/aries-acapy-docs/code/">Code</a><button aria-label="Toggle the collapsible sidebar category &#x27;Code&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/aries-acapy-docs/demo/">Aries Cloud Agent Python (ACA-Py) Demos</a><button aria-label="Toggle the collapsible sidebar category &#x27;Aries Cloud Agent Python (ACA-Py) Demos&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/aries-acapy-docs/developer/">Becoming an Indy/Aries Developer</a><button aria-label="Toggle the collapsible sidebar category &#x27;Becoming an Indy/Aries Developer&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/aries-acapy-docs/docs/">Hyperledger Aries Cloud Agent - Python</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hyperledger Aries Cloud Agent - Python&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/AdminAPI">ACA-Py Administration API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/AnoncredsProofValidation">Anoncreds Proof Validation in Aca-Py</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/ContainerImagesAndGithubActions">Container Images and Github Actions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/DIDMethods">DID methods in ACA-Py</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/DIDResolution">DID Resolution in ACA-Py</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/Databases">Databases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/DevReadMe">Developer&#x27;s Read Me for Hyperledger Aries Cloud Agent - Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/Endorser">Transaction Endorser Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/JsonLdCredentials">JSON-LD Credentials in ACA-Py</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/Logging">Logging docs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/Mediation">Mediation docs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/Multicredentials">Multi-Credentials</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/aries-acapy-docs/docs/Multiledger">Multi-ledger in ACA-Py</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/Multitenancy">Multi-tenancy in ACA-Py</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/RedisPlugins">ACA-Py Redis Plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/SupportedRFCs">Aries AIP and RFCs Supported in Aries Cloud Agent Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/Troubleshooting">Troubleshooting Aries Cloud Agent Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/UsingOpenAPI">Aries Cloud Agent-Python (ACA-Py) - OpenAPI Code Generation Considerations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aries-acapy-docs/docs/deploymentModel">Aries Cloud Agent-Python (ACA-Py) - Deployment Model</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/aries-acapy-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/aries-acapy-docs/docs/"><span itemprop="name">Hyperledger Aries Cloud Agent - Python</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Multi-ledger in ACA-Py</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Multi-ledger in ACA-Py </h1><p>Ability to use multiple Indy ledgers (both IndySdk and IndyVdr) for resolving a <code>DID</code> by the ACA-Py agent. For read requests, checking of multiple ledgers in parallel is done dynamically according to logic detailed in <a href="#read-requests">Read Requests Ledger Selection</a>. For write requests, dynamic allocation of <code>write_ledger</code> is not supported. Write ledger can be assigned using <code>is_write</code> in the <a href="#config-properties">configuration</a> or using any of the <code>--genesis-url</code>, <code>--genesis-file</code>, and <code>--genesis-transactions</code> startup (ACA-Py) arguments. If no write ledger is assigned then a <code>ConfigError</code> is raised.</p><p>More background information including problem statement, design (algorithm) and more can be found <a href="https://docs.google.com/document/d/109C_eMsuZnTnYe2OAd02jAts1vC4axwEKIq7_4dnNVA" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-contents--omit-in-toc-">Table of Contents <a href="#table-of-contents--omit-in-toc-" class="hash-link" aria-label="Direct link to Table of Contents " title="Direct link to Table of Contents ">​</a></h2><ul><li><a href="#usage">Usage</a><ul><li><a href="#example-config-file">Example config file:</a></li><li><a href="#config-properties">Config properties</a></li></ul></li><li><a href="#multi-ledger-admin-api">Multi-ledger Admin API</a></li><li><a href="#ledger-selection">Ledger Selection</a><ul><li><a href="#read-requests">Read Requests</a><ul><li><a href="#for-checking-ledger-in-parallel">For checking ledger in parallel</a></li></ul></li><li><a href="#write-requests">Write Requests</a></li></ul></li><li><a href="#a-special-warning-for-taa-acceptance">A Special Warning for TAA Acceptance</a></li><li><a href="#impact-on-other-aca-py-function">Impact on other ACA-Py function</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a href="#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage">​</a></h2><p>Multi-ledger is disabled by default. You can enable support for multiple ledgers using the <code>--genesis-transactions-list</code> startup parameter. This parameter accepts a string which is the path to the <code>YAML</code> configuration file. For example:</p><p><code>--genesis-transactions-list ./aries_cloudagent/config/multi_ledger_config.yml</code></p><p>If <code>--genesis-transactions-list</code> is specified, then <code>--genesis-url, --genesis-file, --genesis-transactions</code> should not be specified.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-config-file">Example config file:<a href="#example-config-file" class="hash-link" aria-label="Direct link to Example config file:" title="Direct link to Example config file:">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- id: localVON</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  is_production: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  genesis_url: &#x27;http://host.docker.internal:9000/genesis&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- id: bcorvinTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  is_production: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  is_write: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  genesis_url: &#x27;http://test.bcovrin.vonx.io/genesis&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="config-properties">Config properties<a href="#config-properties" class="hash-link" aria-label="Direct link to Config properties" title="Direct link to Config properties">​</a></h3><p>For each ledger, the required properties are as following:</p><ul><li><code>id</code>*<!-- -->: The id (or name) of the ledger, can also be used as the pool name if none provided</li><li><code>is_production</code>*<!-- -->: Whether the ledger is a production ledger. This is used by the pool selector algorithm to know which ledger to use for certain interactions (i.e. prefer production ledgers over non-production ledgers)</li></ul><p>For connecting to ledger, one of the following needs to be specified:</p><ul><li><code>genesis_file</code>: The path to the genesis file to use for connecting to an Indy ledger.</li><li><code>genesis_transactions</code>: String of genesis transactions to use for connecting to an Indy ledger.</li><li><code>genesis_url</code>: The url from which to download the genesis transactions to use for connecting to an Indy ledger.</li></ul><p>Optional properties:</p><ul><li><code>pool_name</code>: name of the indy pool to be opened</li><li><code>keepalive</code>: how many seconds to keep the ledger open</li><li><code>socks_proxy</code></li><li><code>is_write</code>: Whether the ledger is the write ledger. Only one ledger can be assigned, otherwise a <code>ConfigError</code> is raised.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="multi-ledger-admin-api">Multi-ledger Admin API<a href="#multi-ledger-admin-api" class="hash-link" aria-label="Direct link to Multi-ledger Admin API" title="Direct link to Multi-ledger Admin API">​</a></h2><p>Multi-ledger related actions are grouped under the <code>ledger</code> topic in the SwaggerUI or under <code>/ledger/multiple</code> path.</p><ul><li><code>/ledger/multiple/config</code>:
Returns the multiple ledger configuration currently in use</li><li><code>/ledger/multiple/get-write-ledger</code>:
Returns the current active/set <code>write_ledger&#x27;s</code> <code>ledger_id</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ledger-selection">Ledger Selection<a href="#ledger-selection" class="hash-link" aria-label="Direct link to Ledger Selection" title="Direct link to Ledger Selection">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="read-requests">Read Requests<a href="#read-requests" class="hash-link" aria-label="Direct link to Read Requests" title="Direct link to Read Requests">​</a></h3><p>The following process is executed for these functions in ACA-Py:</p><ol><li><code>get_schema</code></li><li><code>get_credential_definition</code></li><li><code>get_revoc_reg_def</code></li><li><code>get_revoc_reg_entry</code></li><li><code>get_key_for_did</code></li><li><code>get_all_endpoints_for_did</code></li><li><code>get_endpoint_for_did</code></li><li><code>get_nym_role</code></li><li><code>get_revoc_reg_delta</code></li></ol><p>If multiple ledgers are configured then <code>IndyLedgerRequestsExecutor</code> service extracts <code>DID</code> from the record identifier and executes the <a href="#for-checking-ledger-in-parallel">check</a> below, else it returns the <code>BaseLedger</code> instance.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="for-checking-ledger-in-parallel">For checking ledger in parallel<a href="#for-checking-ledger-in-parallel" class="hash-link" aria-label="Direct link to For checking ledger in parallel" title="Direct link to For checking ledger in parallel">​</a></h4><ul><li><code>lookup_did_in_configured_ledgers</code> function<ul><li>If the calling function (above) is in <!-- -->[1-4]<!-- -->, then check the <code>DID</code> in <code>cache</code> for a corresponding applicable <code>ledger_id</code>. If found, return the ledger info, else continue.</li><li>Otherwise, launch parallel <code>_get_ledger_by_did</code> tasks for each of the configured ledgers.</li><li>As these tasks get finished, construct <code>applicable_prod_ledgers</code> and <code>applicable_non_prod_ledgers</code> dictionaries, each with <code>self_certified</code> and <code>non_self_certified</code> inner dict which are sorted by the original order or index.</li><li>Order/preference for selection: <code>self_certified</code> &gt; <code>production</code> &gt; <code>non_production</code><ul><li>Checks <code>production</code> ledger where the <code>DID</code> is <code>self_certified</code></li><li>Checks <code>non_production</code> ledger where the <code>DID</code> is <code>self_certified</code></li><li>Checks <code>production</code> ledger where the <code>DID</code> is not <code>self_certified</code></li><li>Checks <code>non_production</code> ledger where the <code>DID</code> is not <code>self_certified</code></li></ul></li><li>Return an applicable ledger if found, else raise an exception.</li></ul></li><li><code>_get_ledger_by_did</code> function<ul><li>Build and submit <code>GET_NYM</code></li><li>Wait for a response for 10 seconds, if timed out return None</li><li>Parse response</li><li>Validate state proof</li><li>Check if <code>DID</code> is self certified</li><li>Returns ledger info to <code>lookup_did_in_configured_ledgers</code></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="write-requests">Write Requests<a href="#write-requests" class="hash-link" aria-label="Direct link to Write Requests" title="Direct link to Write Requests">​</a></h3><p>On startup, the first configured applicable ledger is assigned as the <code>write_ledger</code> <!-- -->[<code>BaseLedger</code>]<!-- -->, the selection is dependant on the order (top-down) and whether it is <code>production</code> or <code>non_production</code>. For instance, considering this <a href="#example-config-file">example configuration</a>, ledger <code>bcorvinTest</code> will be set as <code>write_ledger</code> as it is the topmost <code>production</code> ledger. If no <code>production</code> ledgers are included in configuration then the topmost <code>non_production</code> ledger is selected.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-special-warning-for-taa-acceptance">A Special Warning for TAA Acceptance<a href="#a-special-warning-for-taa-acceptance" class="hash-link" aria-label="Direct link to A Special Warning for TAA Acceptance" title="Direct link to A Special Warning for TAA Acceptance">​</a></h2><p>When you run in multi-ledger mode, ACA-Py will use the <code>pool-name</code> (or <code>id</code>) specified in the ledger configuration file for each ledger.</p><p>(When running in single-ledger mode, ACA-Py uses <code>default</code> as the ledger name.)</p><p>If you are running against a ledger in <code>write</code> mode, and the ledger requires you to accept a Transaction Author Agreement (TAA), ACA-Py stores the TAA acceptance
status in the wallet in a non-secrets record, using the ledger&#x27;s <code>pool_name</code> as a key.</p><p>This means that if you are upgrading from single-ledger to multi-ledger mode, you will need to <em>either</em>:</p><ul><li>set the <code>id</code> for your writable ledger to <code>default</code> (in your <code>ledgers.yaml</code> file)</li></ul><p><em>or</em>:</p><ul><li>re-accept the TAA once you restart your ACA-Py in multi-ledger mode</li></ul><p>Once you re-start ACA-Py, you can check the <code>GET /ledger/taa</code> endpoint to verify your TAA acceptance status.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="impact-on-other-aca-py-function">Impact on other ACA-Py function<a href="#impact-on-other-aca-py-function" class="hash-link" aria-label="Direct link to Impact on other ACA-Py function" title="Direct link to Impact on other ACA-Py function">​</a></h2><p>There should be no impact/change in functionality to any ACA-Py protocols.</p><p><code>IndySdkLedger</code> was refactored by replacing <code>wallet: IndySdkWallet</code> instance variable with <code>profile: Profile</code> and accordingly <code>.aries_cloudagent/indy/credex/verifier</code>, <code>.aries_cloudagent/indy/models/pres_preview</code>, <code>.aries_cloudagent/indy/sdk/profile.py</code>, <code>.aries_cloudagent/indy/sdk/verifier</code>, <code>./aries_cloudagent/indy/verifier</code> were also updated.</p><p>Added <code>build_and_return_get_nym_request</code> and <code>submit_get_nym_request</code> helper functions to <code>IndySdkLedger</code> and <code>IndyVdrLedger</code>.</p><p>Best practice/feedback emerging from <code>Askar session deadlock</code> issue and <code>endorser refactoring</code> PR was also addressed here by not leaving sessions open unnecessarily and changing <code>context.session</code> to <code>context.profile.session</code>, etc.</p><p>These changes are made here:</p><ul><li><code>./aries_cloudagent/ledger/routes.py</code></li><li><code>./aries_cloudagent/messaging/credential_definitions/routes.py</code></li><li><code>./aries_cloudagent/messaging/schemas/routes.py</code></li><li><code>./aries_cloudagent/protocols/actionmenu/v1_0/routes.py</code></li><li><code>./aries_cloudagent/protocols/actionmenu/v1_0/util.py</code></li><li><code>./aries_cloudagent/protocols/basicmessage/v1_0/routes.py</code></li><li><code>./aries_cloudagent/protocols/coordinate_mediation/v1_0/handlers/keylist_handler.py</code></li><li><code>./aries_cloudagent/protocols/coordinate_mediation/v1_0/routes.py</code></li><li><code>./aries_cloudagent/protocols/endorse_transaction/v1_0/routes.py</code></li><li><code>./aries_cloudagent/protocols/introduction/v0_1/handlers/invitation_handler.py</code></li><li><code>./aries_cloudagent/protocols/introduction/v0_1/routes.py</code></li><li><code>./aries_cloudagent/protocols/issue_credential/v1_0/handlers/credential_issue_handler.py</code></li><li><code>./aries_cloudagent/protocols/issue_credential/v1_0/handlers/credential_offer_handler.py</code></li><li><code>./aries_cloudagent/protocols/issue_credential/v1_0/handlers/credential_proposal_handler.py</code></li><li><code>./aries_cloudagent/protocols/issue_credential/v1_0/handlers/credential_request_handler.py</code></li><li><code>./aries_cloudagent/protocols/issue_credential/v1_0/routes.py</code></li><li><code>./aries_cloudagent/protocols/issue_credential/v2_0/routes.py</code></li><li><code>./aries_cloudagent/protocols/present_proof/v1_0/handlers/presentation_handler.py</code></li><li><code>./aries_cloudagent/protocols/present_proof/v1_0/handlers/presentation_proposal_handler.py</code></li><li><code>./aries_cloudagent/protocols/present_proof/v1_0/handlers/presentation_request_handler.py</code></li><li><code>./aries_cloudagent/protocols/present_proof/v1_0/routes.py</code></li><li><code>./aries_cloudagent/protocols/trustping/v1_0/routes.py</code></li><li><code>./aries_cloudagent/resolver/routes.py</code></li><li><code>./aries_cloudagent/revocation/routes.py</code></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/hyperledger/aries-acapy-docs/tree/main/docs/docusaurus/docs/docs/Multiledger.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/aries-acapy-docs/docs/Multicredentials"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Multi-Credentials</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/aries-acapy-docs/docs/Multitenancy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Multi-tenancy in ACA-Py</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#table-of-contents--omit-in-toc-" class="table-of-contents__link toc-highlight">Table of Contents  omit in toc </a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a><ul><li><a href="#example-config-file" class="table-of-contents__link toc-highlight">Example config file:</a></li><li><a href="#config-properties" class="table-of-contents__link toc-highlight">Config properties</a></li></ul></li><li><a href="#multi-ledger-admin-api" class="table-of-contents__link toc-highlight">Multi-ledger Admin API</a></li><li><a href="#ledger-selection" class="table-of-contents__link toc-highlight">Ledger Selection</a><ul><li><a href="#read-requests" class="table-of-contents__link toc-highlight">Read Requests</a></li><li><a href="#write-requests" class="table-of-contents__link toc-highlight">Write Requests</a></li></ul></li><li><a href="#a-special-warning-for-taa-acceptance" class="table-of-contents__link toc-highlight">A Special Warning for TAA Acceptance</a></li><li><a href="#impact-on-other-aca-py-function" class="table-of-contents__link toc-highlight">Impact on other ACA-Py function</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/aries-acapy-docs/">ACA-Py</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hyperledger/aries-acapy-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/aries-acapy-docs/assets/js/runtime~main.55efbebf.js"></script>
<script src="/aries-acapy-docs/assets/js/main.f211ac65.js"></script>
</body>
</html>